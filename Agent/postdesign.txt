POST DESIGN - Tracker
=====================================

WHAT IS A POST?
---------------
A post is opened by:
- Clicking on a map card
- Clicking on a postcard
- Clicking on the marquee
- Arriving at the website via a direct link

STATES:
- Collapsed
- Expanded

WHERE POSTS APPEAR:
- Post panel
- Recent panel
- My Posts panel

POST HEADER (same for collapsed and expanded):
----------------------------------------------
- 50x50 mini thumb on the left (actually 100x100 from Bunny for retina)
- Post title (1-2 lines)
- Share button
- Favorites button

POST BODY:
----------
1. Post info container (most complex - will need components)
2. Post description
3. Post images

=====================================
POST INFO CONTAINER
=====================================

Current contents (in order):

1. Subcategory row - Icon + subcategory display name
2. Venue info - Venue name (bold), address line, city
3. Location button - "X locations" (only if multiple locations)
4. Session button - "dates text" (only if sessions exist)
5. Price button - Price with currency flag (only if price exists)
6. Website URL - clickable link
7. Tickets URL - clickable link
8. Public email - mailto link
9. Phone - tel link
10. Amenities - Amenity summary text
11. Coupon code
12. Age rating
13. Custom fields (5 types: text, textarea, dropdown, checklist, radio)

Items 3-12 are conditional (only render if data exists).
Items 3, 4, 5 are interactive buttons with dropdown arrows.

COMPLEXITY NOTES:
- Multiple locations to handle
- Multiple sessions to handle
- Multiple items for sale
- This container is the heart of the post
- Will likely need dedicated components for its ingredients

=====================================
PLANNED CHANGES:
=====================================

PostLocationComponent redesign:
- Remove separate venue info display
- First location becomes first item in dropdown (not separate)
- Dropdown shows ALL locations (including currently selected)
- Each location option: 70px height
- Button shows currently selected location info
- Clicking expands to show all locations as selectable options

FUTURE (to discuss):
- Map flies to selected location when changed

=====================================
POST LOCATION MINI-MAP PLAN
=====================================

PURPOSE:
- Show all locations for a post on a flat 2D map
- Auto-fit bounds to show all points with padding
- Subcategory icons as markers at each location

STRICT 2-MAP RULE:
1. Main map (always present)
2. SecondaryMap (shared between orbit wallpaper and location mini-map)

NEVER 3 MAPS. SecondaryMap does one job at a time.

MINI-MAP TYPE: Static image with clickable markers
- Reference tool - shows all locations at a glance
- No zoom/pan - would defeat the purpose
- Markers ARE clickable:
  - Click marker → highlight corresponding list item
  - FUTURE: popup asks "fly to this location?"
  - If yes, main map flies there, button updates to show that location

MAP LAYOUT:
- Full width of dropdown
- Aspect ratio 2:1 (width:height) - e.g., 500px wide = 250px high
- Position: directly under first result (at top of menu)
- Part of scroll content (scrolls out of view)
- Style: matches main map's current style

DROPDOWN CONSTRAINTS:
- Max height: 600px
- After 600px: scroll wheel activates

BUTTON TEXT BEHAVIOR:
- Shows currently selected/viewed location
- If user flies to location 2, button shows location 2's info
- Not always showing first location

CACHING:
- In-memory LRU cache (5-10 posts)
- Keyed by post ID
- Cleared on page refresh (no localStorage)
- Jumping between same posts = instant
- Oldest evicted when over limit

FLOW WHEN LOCATION DROPDOWN OPENS:
1. Check cache for this post's mini-map image
2. If cached: display instantly
3. If not cached:
   a. Orbit mode stops, wallpaper converts to still
   b. SecondaryMap captures flat 2D image with bounds + markers
   c. Store in cache
   d. Display image
4. SecondaryMap released, wallpaper can resume

FLOW WHEN LOCATION DROPDOWN CLOSES:
1. Image stays in cache
2. Wallpaper can resume orbit if needed

IMPLEMENTATION COMPLETE:

1. PostLocationMapComponent (components-new.js):
   - render() - returns container HTML
   - init() - checks cache or captures new
   - LRU cache (5 posts) in memory
   - clearCache() for cleanup

2. SecondaryMap.captureWithBounds() added:
   - Sets flat mercator projection
   - Fits bounds with 40px padding
   - Draws 24px markers on canvas
   - Returns data URL

3. CSS (post-new.css):
   - .post-location-map - 2:1 ratio, full width, no padding
   - Loading/error states
   - Reserved space (no layout shift)

4. Event wiring (post-new.js):
   - Map initialized on first dropdown open
   - Uses post.map_cards for locations
   - Uses post.subcategory_icon_url for markers

TODO: Delete unused createPostMap() from map-new.js

=====================================
COMPLETED CHANGES:
=====================================

[2026-02-03] Created menu-class-4 in base-new.css:
- Post info menu styling (location, session, price)
- 600px max height with scroll
- 70px min-height options
- Background: rgba(0,0,0,0.35) - matches other menu classes
- Optional embedded map (.menu-map with 2:1 aspect ratio)
- Bridge classes: menu-button, menu-arrow, menu-options, menu-option
- State classes: menu-button--open, menu-arrow--open, menu-option--highlighted

[2026-02-03] Created four post info components in components-new.js:

1. PostLocationMapComponent
   - render() - returns .post-location-map container
   - init() - checks LRU cache (5 posts) or captures new
   - captureMap() - uses SecondaryMap.captureWithBounds()
   - clearCache() - clears memory cache
   - getFromCache() - retrieves cached image

2. PostLocationComponent
   - Container: .post-location-container.menu-class-4
   - Button: .post-location-button.menu-button
   - Text: .post-location-text.menu-text + -main/-secondary
   - Arrow: .post-location-arrow.menu-arrow
   - Options: .post-location-options.menu-options
   - Option: .post-location-option.menu-option
   - Includes PostLocationMapComponent at top of dropdown

3. PostSessionComponent
   - Container: .post-session-container.menu-class-4
   - Button: .post-session-button.menu-button
   - Text: .post-session-text.menu-text + -main
   - Arrow: .post-session-arrow.menu-arrow

4. PostPriceComponent
   - Container: .post-price-container.menu-class-4
   - Button: .post-price-button.menu-button
   - Text: .post-price-text.menu-text + -main
   - Arrow: .post-price-arrow.menu-arrow
   - Badge: .post-price-badge (currency flag)

[2026-02-03] Added SecondaryMap.captureWithBounds() in components-new.js:
- Switches to flat mercator projection
- Fits bounds with 40px padding, maxZoom 15
- Draws base map to canvas
- Overlays 24px marker icons at each location
- Returns data URL (webp or jpeg)

[2026-02-03] Updated post-new.css:
- .post-location-container, .post-session-container, .post-price-container
- .post-location-map - 2:1 ratio, full width, reserved space
- .post-location-map-image, -loading, -error states
- .post-location-map-marker - 24px absolute positioned

[2026-02-03] Updated post-new.js:
- Components called from buildPostDetail()
- Location dropdown toggle initializes map on first open
- Option selection updates button text and highlights
- Uses post.map_cards for locations, post.subcategory_icon_url for markers

TODO:
- Implement marker click → highlight list item (FUTURE)
- Implement "fly to location" popup (FUTURE)

CLEANUP COMPLETED:
- Deleted unused createPostMap() from map-new.js
- Deleted unused removePostMap() from map-new.js
- Deleted unused postMaps variable from map-new.js
- Removed exports for deleted functions
