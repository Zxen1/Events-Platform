<!doctype html> 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Events Platform</title>
  <link rel="apple-touch-icon" sizes="180x180" href="assets/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicons/favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="assets/favicons/android-chrome-192x192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="assets/favicons/android-chrome-512x512.png" />
  <link rel="manifest" href="assets/favicons/site.webmanifest" />
  <link rel="shortcut icon" href="assets/favicons/favicon.ico" />
  <link id="mapbox-gl-css" rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/v3.15.0/mapbox-gl.css" />

  <style id="hotfixes">
    /* Hand cursor for DOM-based Mapbox markers */
    .mapboxgl-marker,
    .marker,
    .is-clickable {
      cursor: pointer;
    }

    .logo img.is-loading {
      animation: logo-rotate 1s linear infinite;
      transform-origin: 50% 50%;
    }

    @keyframes logo-rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Menus stay clickable above overlays */
    .options-menu { z-index: 10000; }

    /* Cards stay clickable on narrow screens */
    @media (max-width: 600px){
      .post-card, .post { position: relative; z-index: 2; }
    }
  </style>

  <script>

<script>
// === SINGLE SOURCE OF TRUTH: 150x40 black pill sprite ===
(function(){
  const PILL_ID = 'marker-label-bg';
  const PILL_W = 150, PILL_H = 40, PILL_R = 20;
  const PILL_COLOR = '#000';

  function drawRoundedRect(ctx, x, y, w, h, r) {
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x + rr, y);
    ctx.arcTo(x + w, y, x + w, y + h, rr);
    ctx.arcTo(x + w, y + h, x, y + h, rr);
    ctx.arcTo(x, y + h, x, y, rr);
    ctx.arcTo(x, y, x + w, y, rr);
    ctx.closePath();
  }

  function addPill(map){
    try{
      if(!map || typeof map.hasImage !== 'function') return;
      if(map.hasImage(PILL_ID)) { try{ map.removeImage(PILL_ID); }catch(e){} }
      const c = document.createElement('canvas');
      c.width = PILL_W; c.height = PILL_H;
      const ctx = c.getContext('2d');
      ctx.clearRect(0,0,PILL_W,PILL_H);
      ctx.fillStyle = PILL_COLOR;
      drawRoundedRect(ctx, 0, 0, PILL_W, PILL_H, PILL_R);
      ctx.fill();
      map.addImage(PILL_ID, c, { pixelRatio: 1 });
    }catch(e){}
  }

  window.__addPill150x40 = addPill;
})();
</script>

    (function(){
      const LOADING_CLASS = 'is-loading';
      let pendingCount = 0;
      let logoImg = null;
      let updatePending = false;
      let stopRequested = false;
      let stopTimeoutId = null;

      function handleAnimationLoop(){
        if(stopRequested && pendingCount === 0){
          finalizeStop();
        }
      }

      function ensureLogo(){
        if(!logoImg){
          logoImg = document.querySelector('.logo img');
          if(logoImg && !logoImg.__logoAnimationBound){
            try{
              logoImg.addEventListener('animationiteration', handleAnimationLoop);
              logoImg.addEventListener('animationend', handleAnimationLoop);
            }catch(err){}
            logoImg.__logoAnimationBound = true;
          }
        }
        return logoImg;
      }

      function finalizeStop(){
        const img = ensureLogo();
        if(!img){
          return;
        }
        stopRequested = false;
        if(stopTimeoutId){
          clearTimeout(stopTimeoutId);
          stopTimeoutId = null;
        }
        if(img.classList && img.classList.contains(LOADING_CLASS)){
          img.classList.remove(LOADING_CLASS);
        } else if(!img.classList && img.style){
          img.style.animation = '';
        }
      }

      function requestStop(){
        const img = ensureLogo();
        if(!img){
          return;
        }
        if(pendingCount > 0){
          return;
        }
        let isAnimating = false;
        if(img.classList){
          isAnimating = img.classList.contains(LOADING_CLASS);
        } else if(img.style){
          isAnimating = typeof img.style.animation === 'string' && img.style.animation !== '';
        }
        if(!isAnimating){
          finalizeStop();
          return;
        }
        if(stopRequested){
          return;
        }
        stopRequested = true;
        if(stopTimeoutId){
          clearTimeout(stopTimeoutId);
        }
        stopTimeoutId = setTimeout(()=>{
          if(stopRequested && pendingCount === 0){
            finalizeStop();
          }
        }, 1200);
      }

      function applyState(){
        updatePending = false;
        const img = ensureLogo();
        if(!img){
          return;
        }
        if(pendingCount > 0){
          stopRequested = false;
          if(stopTimeoutId){
            clearTimeout(stopTimeoutId);
            stopTimeoutId = null;
          }
          if(img.classList && !img.classList.contains(LOADING_CLASS)){
            img.classList.add(LOADING_CLASS);
          } else if(!img.classList){
            img.style.animation = 'logo-rotate 1s linear infinite';
          }
        } else {
          requestStop();
        }
      }

      function scheduleUpdate(){
        if(updatePending){
          return;
        }
        updatePending = true;
        if(typeof requestAnimationFrame === 'function'){
          requestAnimationFrame(applyState);
        } else {
          setTimeout(applyState, 0);
        }
      }

      function begin(){
        pendingCount++;
        scheduleUpdate();
      }

      function end(){
        if(pendingCount > 0){
          pendingCount--;
        }
        scheduleUpdate();
      }

      if(document.readyState === 'complete' || document.readyState === 'interactive'){
        ensureLogo();
        scheduleUpdate();
      } else {
        document.addEventListener('DOMContentLoaded', () => {
          ensureLogo();
          scheduleUpdate();
        });
      }

      window.addEventListener('pageshow', () => {
        ensureLogo();
        scheduleUpdate();
      });

      const originalFetch = window.fetch;
      if(typeof originalFetch === 'function'){
        window.fetch = function(...args){
          begin();
          let finished = false;
          const finalize = () => {
            if(finished) return;
            finished = true;
            end();
          };
          try{
            const response = originalFetch.apply(this, args);
            Promise.resolve(response).then(finalize, finalize);
            return response;
          } catch(err){
            finalize();
            throw err;
          }
        };
      }

      if('XMLHttpRequest' in window && XMLHttpRequest.prototype){
        const originalSend = XMLHttpRequest.prototype.send;
        if(typeof originalSend === 'function'){
          XMLHttpRequest.prototype.send = function(...args){
            begin();
            let finalized = false;
            const finalize = () => {
              if(finalized) return;
              finalized = true;
              this.removeEventListener('loadend', finalize);
              end();
            };
            this.addEventListener('loadend', finalize);
            try{
              return originalSend.apply(this, args);
            } catch(err){
              finalize();
              throw err;
            }
          };
        }
      }

      const loaderApi = (()=>{
        const api = {
          begin(){ begin(); },
          end(){ end(); },
          track(promise){
            if(!promise || typeof promise.then !== 'function'){
              return promise;
            }
            let settled = false;
            begin();
            const finalize = () => {
              if(settled) return;
              settled = true;
              end();
            };
            Promise.resolve(promise).then(finalize, finalize);
            return promise;
          }
        };
        return api;
      })();

      const existingLoader = window.__logoLoading && typeof window.__logoLoading === 'object'
        ? window.__logoLoading
        : {};
      existingLoader.begin = loaderApi.begin;
      existingLoader.end = loaderApi.end;
      existingLoader.track = loaderApi.track;
      existingLoader.trackPromise = loaderApi.track;
      window.__logoLoading = existingLoader;
    })();
  </script>

  <style id="mapboxgl-critical-css">
    .mapboxgl-map{position:relative;width:100%;height:100%}
    .mapboxgl-canvas{position:absolute;left:0;top:0}
    .mapboxgl-canvas-container{position:absolute;inset:0}
    .mapboxgl-ctrl{box-sizing:border-box}
  </style>
  <link
    rel="stylesheet"
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css"
    data-fallback="https://unpkg.com/@mapbox/mapbox-gl-geocoder@5.0.0/dist/mapbox-gl-geocoder.css"
    onerror="if(this.dataset.fallback && this.href !== this.dataset.fallback){this.dataset.fallbackState='retry';this.href=this.dataset.fallback;}else{this.dataset.fallbackState='failed';}"
  />
  <style>:root{
  --header-h: 56px;
  --subheader-h: 0;
  --panel-w: 440px;
  --results-w: 530px;
  --post-board-max-w: 530px;
  --gap: 10px;
  --logo-size: 40px;
    --filter-panel-offset: 0px;
    --media-h: 200px;
    --calendar-scale: 1;
    --ink: #ffffff;
    --ink-d: #ececec;
    --gold: #ffc107; 
    --muted: #777;
      --primary: #3E5393;
      --secondary: #000000;
      --accent: #5C6FB1;
      --active: #2E3A72;
      --background: rgba(41,41,41,1);
      --text: #ffffff;
      --button-text: #ffffff;
      --button-hover-text: #ffffff;
      --button-active-text: #ffffff;
      --button-disabled-text: #666666;
      --btn: #333333;
      --btn-hover: #4d4d4d;
      --btn-active: #1a1a1a;
      --btn-selected: #2e3a72;
      --btn-selected-hover: #3c4b8a;
      --btn-selected-active: #232e59;
      --btn-disabled: #bbbbbb;
      --panel-bg: rgba(0,0,0,1);
      --panel-text: #000000;
      --footer-h: 0px;
      --list-background: rgba(0,0,0,0.37);
      --closed-card-bg: rgba(0,0,0,0.37);
      --scrollbar-track: rgba(0,0,0,0);
      --scrollbar-thumb: rgba(0,0,0,0.3);
      --scrollbar-thumb-hover: rgba(0,0,0,0.5);
      --scrollbar-h: 8px;
      --border: rgba(173,173,173,0.31);
      --border-hover: rgba(255,136,0,0.43);
      --border-active: rgba(255,200,0,0.45);
      --placeholder-text: gray;
      --filter-placeholder-text: var(--placeholder-text);
      --popup-bg: rgba(0,0,0,1);
      --popup-text: #ffffff;
      --dropdown-title: #000000;
      --dropdown-selected-bg: #7c4dff;
      --dropdown-selected-text: #ffffff;
      --dropdown-text: #000000;
      --dropdown-bg: rgba(255,255,255,1);
      --dropdown-hover-bg: rgba(224,224,224,1);
      --dropdown-hover-text: #000000;
        --dropdown-venue-text: #000000;
        --dropdown-radius: 8px;
        --calendar-width: 250px;
        --calendar-height: 200px;
        --calendar-cell-w: calc(var(--calendar-width) / 7);
        --calendar-header-h: 20px;
        --calendar-cell-h: calc((var(--calendar-height) - var(--calendar-header-h)) / 7);
        --calendar-past-bg: #f0f0f0;
        --calendar-future-bg: #ffffff;
        --session-available: #888888;
        --session-selected: #2e3a72;
        --today: #ff0000;
        --image-panel-bg: rgba(0,0,0,0.7);
      --filter-active-color: #7c4dff;
      --category-switch-active: #00b050;
      --keyword-bg: #FFFFFF;
      --date-range-bg: rgba(74,74,74,0.9);
      --date-range-text: rgba(255,255,255,1);
      --control-h: 35px;
      --geocoder-h: var(--control-h);
      --panel-label-font: system-ui, sans-serif;
      --panel-label-size: 14px;
      --panel-label-color: #ffffff;
      --panel-title-font: system-ui, sans-serif;
      --panel-title-size: 16px;
      --panel-title-color: #ffffff;
      --post-mode-bg-color: 0,0,0;
      --post-mode-bg-opacity: 0;
      --safe-top: env(safe-area-inset-top, 0px);
}

*:not([class*="mapboxgl-"]){
  box-sizing: border-box;
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
  border-color: var(--border) !important;
}

fieldset{
  margin:0;
  padding:6px 0 0;
  border:0 !important;
}

*:not([class*="mapboxgl-"]):hover{
  border-color: var(--border-hover) !important;
}

*:not([class*="mapboxgl-"]):active{
  border-color: var(--border-active) !important;
}

*[aria-pressed="true"]:not([class*="mapboxgl-"]),
*[aria-current="page"]:not([class*="mapboxgl-"]),
.selected:not([class*="mapboxgl-"]),
.on:not([class*="mapboxgl-"]){
  border-color: var(--border-active) !important;
  color: var(--active);
}

*[aria-selected="true"]:not([class*="mapboxgl-"]){
  border-color: var(--border-active) !important;
}

html,body{
  height: 100%;
}

*:not([class*="mapboxgl-"])::-webkit-scrollbar{
  width:var(--scrollbar-h);
  height:var(--scrollbar-h);
}
*:not([class*="mapboxgl-"])::-webkit-scrollbar-track{
  background:var(--scrollbar-track);
}
*:not([class*="mapboxgl-"])::-webkit-scrollbar-thumb{
  background:var(--scrollbar-thumb);
  border-radius:0;
}
*:not([class*="mapboxgl-"])::-webkit-scrollbar-thumb:hover{
  background:var(--scrollbar-thumb-hover);
}

  body{
    margin: 0;
    font: 13px system-ui, sans-serif;
    background: var(--background);
    color: var(--text);
    overflow: hidden;
    cursor: auto;
    caret-color: transparent;
    display: flex;
    flex-direction: column;
    min-height: calc(var(--vh, 1vh) * 100);
    user-select: text;
    touch-action: manipulation;
  }

  body, .post-board, .second-post-column{
    overscroll-behavior: contain;
  }
  .panel-content, .options-menu, .calendar-scroll{
    overscroll-behavior: contain;
  }

  h1, h2, h3, h4, h5, h6{
    font-size: 16px;
    font-weight: bold;
  }

input,
textarea,
.wysiwyg{
  caret-color: auto;
  user-select: text;
}

button:not([class*="mapboxgl-ctrl"]),
[role="button"]{
  background: var(--btn);
  border: 1px solid var(--btn);
  color: var(--button-text);
  font-size: 13px;
  padding: 0 10px;
  height: var(--control-h);
  min-width: 35px;
  border-radius: 8px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  cursor: pointer;
  transition: background .2s,border-color .2s,color .2s,transform .05s;
}

button:hover,
[role="button"]:hover{
  background: var(--btn-hover);
  border-color: var(--btn-hover);
  color: var(--button-hover-text);
}

button:active,
[role="button"]:active{
  background: var(--btn-active);
  border-color: var(--btn-active);
  color: var(--button-active-text);
}

button[aria-pressed="true"],
[role="button"][aria-pressed="true"],
button[aria-current="page"],
[role="button"][aria-current="page"],
button[aria-selected="true"],
[role="button"][aria-selected="true"],
button.selected,
[role="button"].selected,
button.on,
[role="button"].on{
  background: var(--button-selected-bg, var(--btn-selected));
  border-color: var(--button-selected-border, var(--button-selected-bg, var(--btn-selected))) !important;
  color: var(--button-selected-text, var(--button-active-text)) !important;
}

button[aria-pressed="true"]:hover,
[role="button"][aria-pressed="true"]:hover,
button[aria-current="page"]:hover,
[role="button"][aria-current="page"]:hover,
button[aria-selected="true"]:hover,
[role="button"][aria-selected="true"]:hover,
button.selected:hover,
[role="button"].selected:hover,
button.on:hover,
[role="button"].on:hover{
  background: var(--button-selected-hover, var(--btn-selected-hover));
  border-color: var(--button-selected-hover-border, var(--button-selected-hover, var(--btn-selected-hover))) !important;
  color: var(--button-selected-hover-text, var(--button-selected-text, var(--button-active-text))) !important;
}

button[aria-pressed="true"]:active,
[role="button"][aria-pressed="true"]:active,
button[aria-current="page"]:active,
[role="button"][aria-current="page"]:active,
button[aria-selected="true"]:active,
[role="button"][aria-selected="true"]:active,
button.selected:active,
[role="button"].selected:active,
button.on:active,
[role="button"].on:active{
  background: var(--button-selected-active, var(--btn-selected-active));
  border-color: var(--button-selected-active-border, var(--button-selected-active, var(--btn-selected-active))) !important;
  color: var(--button-selected-active-text, var(--button-selected-text, var(--button-active-text))) !important;
}

a{
  color: var(--primary);
}

a:hover{
  color: var(--accent);
}

a:active{
  color: var(--active);
}
button:active,
[role="button"]:active{
  transform: scale(0.97);
}
button:focus-visible,
[role="button"]:focus-visible{
  outline:2px solid #ffffff;
  outline-offset:2px;
}

button:disabled,
[role="button"][aria-disabled="true"],
button.disabled,
[role="button"].disabled{
  background: var(--btn-disabled);
  border-color: var(--btn-disabled);
  color: var(--button-disabled-text);
  cursor: not-allowed;
  opacity: 0.6;
}

button:disabled:hover,
[role="button"][aria-disabled="true"]:hover,
button.disabled:hover,
[role="button"].disabled:hover{
  background: var(--btn-disabled);
  border-color: var(--btn-disabled);
  color: var(--button-disabled-text);
}

input::placeholder,
textarea::placeholder{
  color: var(--placeholder-text);
  font-size: inherit;
}
#filterPanel #keyword-textbox::placeholder{
  color: var(--filter-placeholder-text);
  font-size: inherit;
}
#filterPanel #daterange-textbox::placeholder{
  color: var(--filter-placeholder-text);
  font-size: inherit;
}

.field label{
  color: var(--panel-label-color);
  font-size: var(--panel-label-size);
}

.panel-content .title,
.panel-content .t{
  color: var(--panel-title-color);
  font-size: var(--panel-title-size);
}

select{
  background: var(--dropdown-bg);
  color: var(--dropdown-text);
  border-radius: var(--dropdown-radius);
}
.venue-select{
  color: var(--dropdown-venue-text);
}
select option{
  background: var(--dropdown-bg);
  color: var(--dropdown-text);
}
select option:checked{
  background: var(--dropdown-selected-bg);
  color: var(--dropdown-selected-text);
}
select option:hover{
  background: var(--dropdown-hover-bg);
  color: var(--dropdown-hover-text);
}

input[type="text"],
input[type="email"],
input[type="password"],
input[type="search"],
input[type="tel"],
input[type="url"],
textarea,
select{
  height: var(--control-h);
  border-radius: 8px;
}
input[type="checkbox"]{
  width: var(--control-h);
  height: var(--control-h);
  border-radius: 8px;
}

  .header{
    height: calc(var(--header-h) + var(--safe-top));
    min-height: calc(var(--header-h) + var(--safe-top));
    max-height: calc(var(--header-h) + var(--safe-top));
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: var(--safe-top) var(--gap) 0 var(--gap);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 20;
    background: rgba(0,0,0,0.7);
  }

  .logo{
    position: absolute;
    left: var(--gap);
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: var(--gap);
    font-weight: 800;
    letter-spacing: .4px;
    user-select: none;
    cursor: pointer;
  }

.logo img{
  width: var(--logo-size);
  height: var(--logo-size);
  display: block;
}

  .view-toggle{
  position: absolute;
  left: calc(var(--gap) * 2 + var(--logo-size));
  right: var(--gap);
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  height: 40px;
  gap: 10px;
  }

.view-toggle button{
  border: 1px solid var(--btn);
  border-radius: 8px;
  padding: 0;
  width: 40px;
  background: var(--btn);
  color: var(--button-text);
  font-weight: 600;
  cursor: pointer;
  transition: background .2s,border-color .2s,color .2s;
}

.view-toggle button[aria-pressed="true"]{
  background: var(--btn-selected);
  border-color: var(--btn-selected) !important;
  color: var(--button-active-text) !important;
}

.header-buttons{display:flex;gap:10px;position:relative;z-index:1;}

.header-buttons button{width:40px;}

.header button,
.options-menu button:not([class*="mapboxgl-ctrl"]){
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  line-height:1;
}
.header button{
  border-radius:8px;
}
.options-menu button:not([class*="mapboxgl-ctrl"]){
  border-radius:0;
}
.header .gear,
.header a{
  border-radius:8px;
}

.results-arrow,
.dropdown-arrow{
  display:inline-block;
  width:8px;
  height:8px;
  border-style:solid;
  border-width:0 2px 2px 0;
  border-color:currentColor !important;
  color:inherit;
  transition:transform .3s;
}

.options-dropdown > button{
  position:relative;
  padding-right:30px;
}
.results-arrow{
  transform:rotate(45deg);
  transition:transform .3s;
  vertical-align:middle;
}

.options-dropdown .dropdown-arrow,
.options-dropdown .results-arrow{
  position:absolute;
  top:50%;
  right:10px;
  transform:translateY(-50%) rotate(45deg);
  margin-right:0;
}

button[aria-expanded="true"] .dropdown-arrow,
button[aria-expanded="true"] .results-arrow{
  transform:translateY(-50%) rotate(-135deg);
}

/* Spin controls */
#adminPanel .range-wrap{
  display:flex;
  align-items:center;
  gap:8px;
}
#adminPanel .range-wrap input[type="range"]{
  width:300px;
}
#adminPanel .range-wrap span{
  width:40px;
  text-align:right;
}
#adminPanel #balloonSize{
  width:300px;
}
#adminPanel #balloonSizeValue{
  display:inline-block;
  width:40px;
  text-align:right;
  margin-left:8px;
}
  #spinType{
    display:flex;
    gap:6px;
    margin-top:6px;
  }
  #spinType label{
    flex:1;
    border-radius:8px;
    overflow:hidden;
  }
  #spinType input{
    display:none;
  }
  #spinType span{
    display:block;
    padding:0 10px;
    height:35px;
    line-height:35px;
    background:var(--btn);
    color:var(--button-text);
    font-weight:600;
    cursor:pointer;
    text-align:center;
    transition:background .2s,border-color .2s,color .2s;
    border:1px solid var(--btn);
    border-radius:8px;
  }

.gear{
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: rgba(255,255,255,0.2);
  display: grid;
  place-items: center;
  border:1px solid rgba(255,255,255,0.4);
  color: #fff;
}

.gear svg{
  width: 18px;
  height: 18px;
  opacity: .9;
}

.panel{
  position:fixed;
  top:0;
  left:0;
  right:0;
  width:100%;
  height:calc(var(--vh, 1vh) * 100);
  background:transparent;
  display:none;
  z-index:2000;
  pointer-events:none;
}
.panel.show{
  display:block;
}
.modal{
  position:fixed;
  top:0;
  left:0;
  right:0;
  width:100%;
  height:calc(var(--vh, 1vh) * 100);
  background:transparent;
  display:none;
  z-index:2000;
  pointer-events:none;
}
.modal.show{
  display:block;
}
.panel-content{
  position:absolute;
  left:50%;
  top:calc(var(--header-h) + var(--safe-top));
  bottom:var(--footer-h);
  width:440px;
  max-width:440px;
  height:calc((var(--vh, 1vh) * 100) - var(--header-h) - var(--safe-top) - var(--footer-h));
  max-height:calc((var(--vh, 1vh) * 100) - var(--header-h) - var(--safe-top) - var(--footer-h));
  min-height:calc((var(--vh, 1vh) * 100) - var(--header-h) - var(--safe-top) - var(--footer-h));
  border-radius:0;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  pointer-events:auto;
  transition:transform 0.3s ease;
  box-sizing:border-box;
}

.panel-content .resizer{position:absolute;z-index:10;background:transparent;display:none;}
.panel-content .resizer.n{top:0;left:0;right:0;height:6px;cursor:n-resize;}
.panel-content .resizer.s{bottom:0;left:0;right:0;height:6px;cursor:s-resize;}
.panel-content .resizer.e{top:0;right:0;bottom:0;width:6px;cursor:e-resize;}
.panel-content .resizer.w{top:0;left:0;bottom:0;width:6px;cursor:w-resize;}
.panel-content .resizer.ne{top:0;right:0;width:10px;height:10px;cursor:ne-resize;}
.panel-content .resizer.nw{top:0;left:0;width:10px;height:10px;cursor:nw-resize;}
.panel-content .resizer.se{bottom:0;right:0;width:10px;height:10px;cursor:se-resize;}
.panel-content .resizer.sw{bottom:0;left:0;width:10px;height:10px;cursor:sw-resize;}
.panel-body{
  flex:1 1 auto;
  min-height:0;
  overflow-y:auto;
  overflow-y:overlay;
  overflow-x:hidden;
  padding:20px 10px;
  overscroll-behavior:contain;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  gap:20px;
}
.panel-body > *{
  width:100%;
  max-width:420px;
  box-sizing:border-box;
  margin:0 auto;
  min-width:0;
}
.panel-body > *:last-child{
  margin-bottom:0;
}
.panel-body > *:not(.map-control-row) > *{
  width:100%;
  max-width:100%;
  min-width:0;
}
#adminPanel #styleControls{
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:12px;
}
#adminPanel #styleControls > *{
  width:100%;
  max-width:420px;
}
#adminPanel .admin-fieldset,
.admin-fieldset{
  margin:0 auto;
  border:0;
  border-radius:8px;
  padding:0;
  width:100%;
  max-width:420px;
  box-sizing:border-box;
}
#adminPanel .admin-fieldset.collapsed{
  padding:0;
}
  #adminPanel .panel-content,
  #memberPanel .panel-content{
    width:min(440px, 100%);
    max-width:100%;
    height:calc((var(--vh, 1vh) * 100) - var(--header-h) - var(--safe-top) - var(--footer-h));
    max-height:calc((var(--vh, 1vh) * 100) - var(--header-h) - var(--safe-top) - var(--footer-h));
    display:flex;
    flex-direction:column;
    overflow-y:auto;
    overflow-y:overlay;
    left:auto;
    right:0;
  }

  #adminPanel .panel-content{
    background:#222222;
    color:#fff;
  }

  #memberPanel .panel-content{
    background:#222222;
    color:#fff;
  }
#filterPanel .panel-content{
  width:100%;
  max-width:380px;
  background:#555555;
  color:#fff;
  display:flex;
  flex-direction:column;
  overflow-y:auto;
  overflow-y:overlay;
  padding-bottom:calc(10px + env(safe-area-inset-bottom, 0px));
}

#filterPanel .panel-body{
  gap:var(--gap);
  padding:0 10px calc(var(--gap) + env(safe-area-inset-bottom, 0px));
}

#filterPanel button:not([class*="mapboxgl-"]),
#filterPanel .sq,
#filterPanel .tiny{
  background:#333333;
  border: none;
}
#adminPanel button,
#memberPanel button{
  background:#333333;
  color: var(--ink);
  border: none;
}
#adminPanel button{
  height:35px;
  line-height:35px;
}
#adminPanel input[type="color"]{
  width:35px;
  height:35px;
}
#filterPanel input[type="text"]{
  background: var(--panel-bg);
  color: var(--panel-text);
}
#filterPanel .calendar-container{
  background: var(--dropdown-bg);
  position:relative;
  display:flex;
  align-items:stretch;
  overflow-x:auto;
  overflow-y:hidden;
  padding-bottom:var(--scrollbar-h);
  box-sizing:content-box;
  width:auto;
  height:var(--calendar-height);
  max-width:100%;
  border:1px solid var(--border);
  border-radius:8px;
  margin-bottom:calc(-1 * var(--scrollbar-h));
  scrollbar-gutter: stable both-edges;
  overscroll-behavior:contain;
  -webkit-overflow-scrolling:touch;
  touch-action:pan-x pan-y;
}
#filterPanel .calendar-container .today-marker{
  position:absolute;
  bottom:0;
  width:8px;
  height:8px;
  border-radius:50%;
  background:var(--today);
  cursor:pointer;
}
#filterPanel #datePicker{
  width:var(--calendar-width);
  flex:0 0 auto;
}
#filterPanel .calendar{
  display:flex;
  width:max-content;
  transform:scale(var(--calendar-scale));
  transform-origin:top left;
  background:var(--dropdown-bg);
  color:var(--dropdown-text);
}
.calendar .month{
  flex:0 0 auto;
  width:var(--calendar-width);
  height:var(--calendar-height);
}
.calendar .month:not(:first-child){
  border-left:1px solid var(--calendar-past-bg);
}
.calendar .grid{
  width:100%;
  height:calc(var(--calendar-height) - var(--calendar-header-h));
  display:grid;
  grid-template-columns:repeat(7,var(--calendar-cell-w));
  grid-template-rows:repeat(7,var(--calendar-cell-h));
}
.calendar .calendar-header{
  height:var(--calendar-header-h);
  line-height:var(--calendar-header-h);
  text-align:center;
  font-size:inherit;
  color:#fff;
  background:#2e3a72;
}
.calendar .weekday,
.calendar .day{
  width:var(--calendar-cell-w);
  height:var(--calendar-cell-h);
  line-height:var(--calendar-cell-h);
  text-align:center;
  font-size:inherit;
  border-radius:8px;
}
#filterPanel .calendar .weekday,
#filterPanel .calendar .day{
  border-radius:0;
}
#filterPanel .calendar .day.range-start{
  border-top-left-radius:8px;
  border-bottom-left-radius:8px;
}
#filterPanel .calendar .day.range-end{
  border-top-right-radius:8px;
  border-bottom-right-radius:8px;
}
#filterPanel .calendar .day.range-start.range-end{
  border-radius:8px;
}
.calendar .weekday{font-weight:bold;}
.calendar .day{cursor:pointer;}
.calendar .day.empty{cursor:default;background:var(--calendar-future-bg);}
.calendar .day.past{background:var(--calendar-past-bg);color:#b3b3b3;}
.calendar .day.future{background:var(--calendar-future-bg);}
.calendar .day.today{color:var(--today) !important;font-weight:bold;}
.calendar .day.in-range{background:#add8e6;}
.calendar .day.selected{background:var(--session-selected);color:#fff;}
.calendar .day.selected.today{color:var(--today) !important;}
.calendar .day.range-start{border-radius:8px 0 0 8px;}
.calendar .day.range-end{border-radius:0 8px 8px 0;}
.calendar .day.range-start.range-end{border-radius:8px;}
#memberPanel input[type=color]{
  border-radius:8px;
  padding:0;
  height:40px;
  display:block;
}
#welcomeBody{
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  padding:0;
  gap:var(--gap);
}
#welcomeBody > :not(.map-control-row){
  pointer-events:none;
}
#welcomeBody .welcome-logo{
  max-width:100%;
  width:min(100%, 600px);
  max-height:300px;
  height:auto;
  margin:0;
}
#welcomeBody .welcome-illustration{
  max-width:280px;
  width:100%;
  height:auto;
  margin:0;
  border-radius:8px;
}
#welcome-modal{background:rgba(0,0,0,0.7);}
#welcome-modal .modal-content{
  position:absolute;
  width:min(600px, 90vw);
  max-width:90vw;
  background:none;
  border-radius:0;
  display:flex;
  flex-direction:column;
  overflow:visible;
  pointer-events:auto;
}
  @media (max-width:440px){
  #adminPanel .panel-content,
  #memberPanel .panel-content,
  #filterPanel .panel-content{
    width:100%;
    max-width:100%;
    max-height:none;
  }
}
#adminPanel legend{font-weight:600;padding:0 6px;display:flex;align-items:center;gap:6px;justify-content:space-between;cursor:pointer;user-select:none;width:100%;max-width:420px;height:35px;background:var(--btn);border:1px solid var(--btn);border-radius:var(--dropdown-radius);box-sizing:border-box;margin:0 auto;}
#adminPanel legend::after{content:'\25BC';margin-left:auto;font-size:14px;}
#adminPanel fieldset.collapsed legend::after{content:'\25B6';}
#adminPanel fieldset.collapsed > :not(legend){display:none;}
#adminPanel .fieldset-actions{display:flex;gap:4px;margin:4px 6px;}
#adminPanel .fieldset-actions .same-btn{flex:1 1 0;padding:6px;}
#adminPanel .control-row{display:flex;align-items:center;justify-content:space-between;gap:6px;margin:0 auto;padding:10px 0;width:100%;max-width:420px;}
#adminPanel .control-row label:first-child{min-width:80px;font-size:14px;cursor:pointer;user-select:none;}
.control-row > *:last-child{margin-left:auto;width:200px;}
#post-mode-background-field{
  width:100%;
  max-width:420px;
  margin:0 auto;
}
#post-mode-background-row{
  display:flex;
  align-items:center;
  width:100%;
  gap:8px;
  row-gap:8px;
  flex-wrap:wrap;
}
#post-mode-background-row input[type="color"]{
  width:40px;
  height:40px;
  padding:0;
  border-radius:8px;
  flex:0 0 40px;
}
#post-mode-background-row input[type="range"]{
  flex:1 1 160px;
  width:100%;
  max-width:none;
}
#post-mode-background-row span{
  flex:0 0 auto;
  min-width:40px;
  text-align:right;
}

.map-theme-container,
.map-balloon-container,
.map-spin-container{
  background:#444444;
  width:100%;
  max-width:420px;
  padding:10px;
  border-radius:8px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.map-theme-container .panel-field,
.map-balloon-container .panel-field,
.map-spin-container .panel-field{
  width:100%;
}

.settings-style-container,
.settings-welcome-container{
  background:#444444;
  width:100%;
  max-width:420px;
  padding:10px;
  border-radius:8px;
}

.sub-icon svg{
  width:18px;
  height:18px;
  vertical-align:middle;
}
.cat-line{
  display:flex;
  align-items:center;
}
.cat-line .sub-icon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  flex:0 0 auto;
  padding-right:5px;
}
.cat-line .sub-icon:empty{
  display:none;
  padding-right:0;
}
.post-card .sub-icon img,
.post-card .sub-icon svg,
.recents-card .sub-icon img,
.recents-card .sub-icon svg{
  width:18px;
  height:18px;
}
#adminPanel .color-group{
  flex:0 0 200px;
  width:100%;
  max-width:200px;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  position:relative;
}
#autoTheme-row{
  flex-direction:row;
  align-items:center;
  gap:8px;
  margin-left:0;
  width:440px;
  max-width:440px;
}
#autoTheme-row button{
  flex:0 0 auto;
  height:35px;
  padding:0 8px;
  min-width:0;
}
#autoTheme-row input[type=color]{
  flex:0 0 35px;
  width:35px;
  height:35px;
  padding:0;
}
#adminPanel .shadow-group{
  flex:0 0 200px;
  width:100%;
  max-width:200px;
  display:flex;
  gap:4px;
  align-items:center;
}
#adminPanel .shadow-group input[type=color]{
  width:40px;
  height:40px;
  padding:0;
  border-radius:8px;
}
#adminPanel .shadow-group input[type=number]{
  flex:1 1 0;
}
#adminPanel .textpicker{
  flex:0 0 200px;
  width:200px;
  position:relative;
}
#adminPanel .textpicker .text-preview{
  width:100%;
  height:35px;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
#adminPanel .textpicker .text-popup{
  display:none;
  position:absolute;
  top:44px;
  left:0;
  z-index:20;
  background:#fff;
  border:1px solid #ccc;
  border-radius:8px;
  padding:8px;
  width:200px;
}
#adminPanel .textpicker.open .text-popup{display:block;}
#adminPanel .textpicker .text-popup select,
#adminPanel .textpicker .text-popup input[type=color]{
  width:100%;
  margin-top:4px;
  border-radius:var(--dropdown-radius);
  padding:4px;
  box-sizing:border-box;
  height:35px;
}
#adminPanel .textpicker .text-popup input[type=color]{padding:0;}
#adminPanel .textpicker .text-popup .shadow-group{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:4px;
  margin-top:4px;
}
#adminPanel .textpicker .text-popup .shadow-group input[type=color],
#adminPanel .textpicker .text-popup .shadow-group input[type=number]{
  width:100%;
  height:40px;
  border-radius:var(--dropdown-radius);
  padding:0;
  box-sizing:border-box;
}
#adminPanel .admin-fieldset input,
#adminPanel .admin-fieldset select,
#adminPanel .admin-fieldset textarea{
  max-width:200px;
  box-sizing:border-box;
}
#adminPanel .control-row select{
  flex:0 0 200px;
  width:200px;
  max-width:200px;
  margin-left:auto;
  border-radius:var(--dropdown-radius);
  padding:4px;
}
#adminPanel .color-group input[type=color],
#adminPanel .color-group input[type=range]{
  width:100%;
}
#adminPanel .color-group input[type=color]{
  border-radius:8px;
  padding:0;
  height:35px;
  display:block;
  cursor:pointer;
  pointer-events:auto;
}
#adminPanel .range-group{
  display:flex;
  align-items:center;
  gap:4px;
}
#adminPanel .range-group input[type=range]{
  flex:1;
  width:auto;
}
#adminPanel .range-group span{
  min-width:32px;
  text-align:right;
  font-size:14px;
}
#adminPanel .tab-bar{display:flex;gap:6px;}
#adminPanel .tab-bar button{
  flex:1;
  padding:6px 10px;
  border-radius:8px;
  background:var(--btn);
  border:1px solid var(--btn);
  color:var(--button-text);
  cursor:pointer;
}
#adminPanel .tab-panel{display:none;}
#adminPanel .tab-panel.active{display:flex;flex-direction:column;align-items:flex-start;gap:12px;}
#adminPanel .marker-grid{display:flex;flex-direction:column;gap:8px;}
#adminPanel .marker-grid select{min-width:120px;}
#adminPanel .marker-options{display:flex;gap:8px;align-items:center;}
#adminPanel .marker-set{display:grid;grid-template-columns:repeat(10,max-content);gap:4px;}
#adminPanel .marker-set svg.outline *{stroke:#000;stroke-width:1;}
#adminPanel input[type=range]{width:100%;}
.panel-field{
  margin:8px auto;
  display:flex;
  flex-direction:column;
  gap:8px;
  width:100%;
  max-width:420px;
  min-width:0;
}
#adminPanel .panel-field{margin:8px auto;}
#adminPanel h3{margin:0;}
.admin-section{display:flex;flex-direction:column;gap:var(--gap);}
#tab-forms .panel-field{max-width:none;}
.history-group,
.color-group{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.option-label{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}
.option-group{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.option-label > *,
.option-group > *{
  min-width:0;
}
.wysiwyg{
  border:1px solid #ccc;
  min-height:80px;
  padding:8px;
}
.wysiwyg:empty:before{
  content:attr(data-placeholder);
  color:#999;
}
.wysiwyg-toolbar{
  display:flex;
  gap:4px;
}
.wysiwyg-toolbar button{
  padding:4px 6px;
}
.panel-field input,
.panel-field textarea,
.panel-field select{
  padding:8px;
  border-radius:var(--dropdown-radius);
  border:none;
  width:100%;
  max-width:100%;
}
.panel-actions{
  margin-top:10px;
  display:flex;
  gap:10px;
}
.panel-header{
  position:sticky;
  top:0;
  padding:10px;
  border-top-left-radius:0;
  border-top-right-radius:0;
  z-index:1;
  cursor:move;
  display:flex;
  flex-direction:column;
  gap:10px;
  flex-shrink:0;
}
.panel-header .header-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  width:100%;
}
.panel-header .panel-actions{
  margin-top:0;
  margin-left:auto;
  justify-content:flex-end;
}
.panel-header h2{
  margin:0;
}

@media (max-width:440px){
  .panel-header .panel-actions .move-left,
  .panel-header .panel-actions .move-right{
    display:none;
  }
  #post-mode-background-row input[type="range"]{
    flex-basis:100%;
  }
  #post-mode-background-row span{
    text-align:left;
  }
}
#filterPanel .panel-header{
  padding:10px;
}
.palette{
  display:flex;
  gap:10px;
  margin-bottom:10px;
}
.field-item,
.field-instance{
  padding:6px 10px;
  border:1px solid #ccc;
  border-radius:8px;
  background:#f9f9f9;
  cursor:move;
}
.builder-zone{
  min-height:100px;
  border:2px dashed #ccc;
  padding:10px;
}
.field-instance{margin:4px 0;}

.left-tools{
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
  padding-left: 2px;
}

.sq{
  width: 30px;
  height: 30px;
  border-radius: 8px;
  background: var(--btn);
  display: grid;
  place-items: center;
  border: 1px solid var(--btn);
}

.sq svg{
  width: 14px;
  height: 14px;
  opacity: .9;
}

.field{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 0;
  margin:0;
}

.field .input{
  position: relative;
  display:flex;
  align-items:center;
  gap:6px;
  flex:1;
}

.field .options-dropdown{
  flex:1;
}

.field .options-dropdown > button{
  width:100%;
}

.input input,
.input select{
  flex: 1;
  width: 100%;
  height: 35px;
  line-height: 35px;
  border: none;
  padding: 0 12px;
  outline: 0;
  display: flex;
  align-items: center;
}
.input input{
  border-radius: 8px;
  background: var(--btn);
  color: var(--ink);
}
.input select{
  border-radius: var(--dropdown-radius);
}
#filterPanel #keyword-textbox{
  background: var(--keyword-bg);
}
#filterPanel #daterange-textbox{
  background: #333333;
  color: var(--date-range-text);
}

.input .down{
  position: static;
  width: 35px;
  height: 35px;
  border-radius: 8px;
  background: var(--btn);
  cursor: pointer;
  border: 1px solid var(--btn);
  line-height:35px;
  text-align:center;
}
.input .down svg{
  vertical-align:middle;
}
#filterPanel .keyword-clear-button,
#filterPanel .daterange-clear-button{
  position: static;
  width: 35px;
  height: 35px;
  border-radius: 8px;
  background: var(--dropdown-bg);
  cursor: pointer;
  border: 0;
  margin-left: 6px;
  line-height: 35px;
  text-align: center;
  color: var(--dropdown-text);
  opacity:1;
}
#filterPanel .keyword-clear-button.active,
#filterPanel .daterange-clear-button.active{
  background: var(--filter-active-color);
  color: var(--button-text);
  opacity:1;
}

#filterPanel .field label.t{
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  gap: 6px;
}

.expired-row{
  grid-template-columns:1fr auto;
  align-items:center;
  gap:8px;
}
.expired-text{
  color:#fff;
  font-size:14px;
}
.filter-summary{
  font-size:14px;
  width:100%;
  max-width:420px;
  margin:0 auto;
  text-align:center;
}
#filterPanel .panel-header{
  align-items:center;
}
#filterPanel .panel-header #filterSummary{
  margin:0;
}
#filterPanel .panel-body > .filter-panel-actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
}
#filterPanel .panel-body > .filter-panel-actions button{
  flex:0 0 auto;
}

#filterPanel .reset-box,
#filterPanel .sort-field{
  width:100%;
  max-width:420px;
  margin:0 auto;
  padding:0;
}
#filterPanel .reset-box{
  padding:0;
}
#filterPanel .reset-box + .reset-box{
  margin-top:0;
}
#filterPanel .panel-body > .reset-box{
  padding:0;
}
#filterPanel .reset-box #resetBtn{
  width:100%;
}
#filterPanel .sort-field{
  display:flex;
  justify-content:center;
}
#filterPanel .sort-field .options-menu{
  width:100%;
  max-width:420px;
}
.sort-options .sort-option[aria-pressed="true"]{
  background:#2e3a72;
  color:var(--button-active-text);
  border-color:#2e3a72;
}
#filterPanel .filter-basics-container,
#filterPanel .filter-category-container,
#tab-forms .formbuilder-container{
  width:100%;
  max-width:420px;
  margin:0 auto;
  background:#444444;
  border-radius:8px;
  padding:10px;
}
#filterPanel .filter-category-container,
#tab-forms .formbuilder-container{
  margin-top:10px;
}
#filterPanel .keyword-row,
#filterPanel .daterange-row,
#filterPanel .expired-row,
#filterPanel #datePickerContainer{
  width:100%;
  max-width:420px;
  margin:0 auto;
}
#filterPanel .filter-category-container .cats,
#filterPanel .filter-category-container .filter-category-menu,
#tab-forms .formbuilder-container .cats,
#tab-forms .formbuilder-container .filter-category-menu{
  width:100%;
}
.switch{
  position:relative;
  display:inline-block;
  width:48px;
  height:24px;
  flex:0 0 48px;
}
.switch input{
  opacity:0;
  width:0;
  height:0;
}
.switch .slider{
  position:absolute;
  cursor:pointer;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:var(--btn);
  border-radius:24px;
  transition:.2s;
}
.switch .slider:before{
  position:absolute;
  content:'';
  height:20px;
  width:20px;
  left:2px;
  top:2px;
  background:var(--button-text);
  border-radius:50%;
  transition:.2s;
}
.switch input:checked + .slider{
  background:var(--session-selected);
}
#expiredToggle:checked + .slider{
  background:var(--filter-active-color);
}
.switch input:checked + .slider:before{
  transform:translateX(24px);
}

.tiny{
  display: grid;
  place-items: center;
  width: 38px;
  height: 40px;
  border-radius: 8px;
  background: var(--btn);
  cursor: pointer;
  border: 1px solid var(--btn);
}

.tiny svg{
  width: 18px;
  height: 18px;
}

.cats{
  margin:8px 0;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.filter-category-menu{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.filter-category-menu .filter-category-header{
  display:flex;
  align-items:flex-start;
  gap:8px;
}

.filter-category-menu .filter-category-trigger-wrap{
  flex:1;
}

.filter-category-menu .filter-category-trigger{
  height:36px;
  border-radius:8px;
  padding:0 12px;
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:10px;
  background: var(--btn);
  border: 1px solid var(--btn);
  cursor: pointer;
  width: 100%;
  text-align: left;
  color: var(--button-text);
  font: inherit;
  margin: 0;
}

.filter-category-menu .category-logo{
  flex:0 0 24px;
  width:24px;
  height:24px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.filter-category-menu .category-logo img{
  width:24px;
  height:24px;
}

.filter-category-menu .filter-category-trigger .label{
  font-weight:700;
  letter-spacing:.2px;
  flex:1;
}

.filter-category-menu .cat-switch{
  position:relative;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  width:38px;
  height:36px;
  flex:0 0 38px;
  cursor:pointer;
  align-self:flex-start;
}
.filter-category-menu .cat-switch input{
  opacity:0;
  width:0;
  height:0;
}
.filter-category-menu .cat-switch .slider{
  position:absolute;
  top:8px;
  left:0;
  right:0;
  margin:0 auto;
  width:38px;
  height:20px;
  border-radius:16px;
  background:var(--btn);
  border:1px solid var(--btn);
  transition:.2s;
}
.filter-category-menu .cat-switch .slider:before{
  content:'';
  position:absolute;
  width:16px;
  height:16px;
  left:1px;
  top:1px;
  border-radius:50%;
  background:var(--button-text);
  transition:.2s;
}
.filter-category-menu .cat-switch input:checked + .slider{
  background:var(--category-switch-active);
  border-color:var(--category-switch-active);
}
.filter-category-menu .cat-switch input:checked + .slider:before{
  transform:translateX(18px);
}

.filter-category-menu .options-dropdown{
  width:100%;
}

.filter-category-menu .options-menu{
  width:100%;
  box-sizing:border-box;
  position:static;
  margin-top:6px;
  background:transparent;
  border:none;
  padding:0;
  border-radius:0;
  z-index:auto;
}

.filter-category-menu .options-menu button{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:var(--gap);
  border-radius:6px;
  border:1px solid transparent;
  box-sizing:border-box;
  padding:0 12px;
}

.filter-category-menu .options-menu button .subcategory-logo{
  flex:0 0 24px;
  width:24px;
  height:24px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.filter-category-menu .options-menu button .subcategory-logo img{
  width:20px;
  height:20px;
}

.filter-category-menu .options-menu button .subcategory-label{
  flex:1;
  text-align:left;
}

.filter-category-menu .options-menu button .subcategory-switch{
  flex:0 0 auto;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  width:34px;
  height:18px;
  position:relative;
  pointer-events:none;
}

.filter-category-menu .options-menu button .subcategory-switch .track{
  position:absolute;
  inset:0;
  border-radius:12px;
  background:var(--btn);
  border:1px solid var(--btn);
  transition:.2s;
}

.filter-category-menu .options-menu button .subcategory-switch .thumb{
  position:absolute;
  width:14px;
  height:14px;
  border-radius:50%;
  background:var(--button-text);
  left:2px;
  top:2px;
  transition:.2s;
}
.filter-category-menu .options-menu button[aria-pressed="false"]{
  color:var(--muted);
}
.filter-category-menu .options-menu button[aria-pressed="false"] .subcategory-logo{
  opacity:0.6;
}
.filter-category-menu .options-menu button[aria-pressed="false"] .subcategory-logo img{
  filter:grayscale(1);
}
.filter-category-menu .options-menu button[aria-pressed="false"] .subcategory-label{
  color:inherit;
}
.filter-category-menu .options-menu button[aria-pressed="false"] .subcategory-switch .track{
  background:var(--btn);
  border-color:var(--btn);
}
.filter-category-menu .options-menu button[aria-pressed="false"] .subcategory-switch .thumb{
  transform:translateX(0);
  opacity:0.7;
}

.filter-category-menu .options-menu button[aria-pressed="true"]{
  background: var(--dropdown-selected-bg);
  color: var(--dropdown-selected-text);
  border-color: var(--dropdown-selected-bg);
  --button-selected-bg: var(--dropdown-selected-bg);
  --button-selected-border: var(--dropdown-selected-bg);
  --button-selected-text: var(--dropdown-selected-text);
}
.filter-category-menu .options-menu button.on{
  --button-selected-bg: var(--dropdown-selected-bg);
  --button-selected-border: var(--dropdown-selected-bg);
  --button-selected-text: var(--dropdown-selected-text);
}

.filter-category-menu .options-menu button[aria-pressed="true"] .subcategory-switch .track,
.filter-category-menu .options-menu button.on .subcategory-switch .track{
  background:var(--category-switch-active);
  border-color:var(--category-switch-active);
}

.filter-category-menu .options-menu button[aria-pressed="true"] .subcategory-switch .thumb,
.filter-category-menu .options-menu button.on .subcategory-switch .thumb{
  transform:translateX(16px);
}

.filter-category-menu[aria-expanded="true"] .filter-category-trigger{
  border-color: var(--border-active);
}

.filter-category-menu.cat-off{
  opacity:0.6;
}

.filter-category-menu.cat-off .filter-category-trigger{
  cursor:default;
}

.reset-box{
  margin:0;
}

.reset-box .btn{
  width:100%;
  height: 36px;
  border-radius: 8px;
  background: var(--btn);
  border: 1px solid var(--btn);
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 0 14px;
  font-weight: 700;
  letter-spacing: .2px;
  color: var(--ink);
  cursor: pointer;
}
.reset-box .btn.active{
  background: var(--filter-active-color);
  border-color: var(--filter-active-color);
}

.reset-box .btn svg{
  width: 16px;
  height: 16px;
}

.reset-box .arr{
  display: grid;
  place-items: center;
  width: 38px;
  height: 36px;
  border-radius: 8px;
  background: var(--btn);
  border: 1px solid var(--btn);
}

.post-mode-background{
  position:fixed;
  top:calc(var(--header-h) + var(--safe-top));
  bottom:var(--footer-h);
  left:0;
  right:0;
  background: rgba(var(--post-mode-bg-color), var(--post-mode-bg-opacity));
  z-index:1;
  pointer-events:none;
  display:none;
}

.mode-posts .post-mode-background{
  display:block;
  pointer-events:none;
}

.post-mode-boards{
  position:fixed;
  top:calc(var(--header-h) + var(--safe-top));
  bottom:var(--footer-h);
  left:0;
  right:0;
  padding-left:var(--filter-panel-offset);
  padding-right:0;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  gap:var(--gap);
  z-index:2;
  pointer-events:none;
  transition:padding 0.3s ease;
}

body.filter-anchored .post-mode-boards{
  justify-content:flex-start;
}

body.hide-ads .post-mode-boards{padding-right:0;}

.quick-list-board{
  position:fixed;
  top:calc(var(--header-h) + var(--safe-top));
  bottom:var(--footer-h);
  left:0;
  width:440px;
  padding:10px;
  overflow:auto;
  overflow:overlay;
  background:rgba(0,0,0,0);
  pointer-events:auto;
  z-index:2;
  transform:translateX(0);
  transition:transform 0.3s ease;
}

.recents-board{
  position:relative;
  top:auto;
  bottom:auto;
  left:auto;
  padding:0;
  margin:0;
  overflow:auto;
  overflow:overlay;
  overflow-x:hidden;
  background:rgba(0,0,0,0.7);
  transition:margin 0.3s ease;
  display:flex;
  flex-direction:column;
  gap:0;
  pointer-events:auto;
}

.post-board{
  width:var(--post-board-max-w);
  max-width:var(--post-board-max-w);
  flex-shrink:0;
  position:relative;
  left:0;
  opacity:1;
  display:flex;
  flex-direction:column;
  height:auto;
  min-height:0;
  max-height:100%;
  transition:left 0.3s ease, opacity 0.3s ease;
}

.recents-board{
  width:var(--post-board-max-w);
  max-width:var(--post-board-max-w);
  flex-shrink:0;
  height:auto;
  min-height:0;
  max-height:100%;
}
@media (max-width:440px){
  .post-board,
  .recents-board,
  .second-post-column.is-visible{
    width:100%;
    max-width:100%;
  }
  .second-post-column{
    display:none;
  }
}

.last-opened-label{
  font-size:12px;
  margin:0;
  background:#000;
  color:#fff;
  padding:2px 4px;
}

.post-board{
  padding:0;
  margin:0;
  overflow-y:auto;
  overflow-y:overlay;
  overflow-x:hidden;
  display:flex;
  flex-direction:column;
  gap:0;
  background:rgba(0,0,0,0.7);
  pointer-events:auto;
  transition:left 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
}
.post-board .post-card{
  width:100%;
  max-width:100%;
}

.post-board .open-post{
  width:100%;
  max-width:100%;
}

.recents-board .recents-card{
  width:100%;
  max-width:100%;
}
.recents-board .recents-card{
  margin:0;
  border-radius:0;
  background-color:transparent;
  border-bottom:1px solid rgba(255,255,255,0.12);
}
.recents-board .recents-card:last-child{border-bottom:none;}

.post-board .post-body,
.recents-board .post-body{
  display:flex;
  flex-direction:column;
  padding-bottom:10px;
  gap:0;
  position:relative;
}

.main-post-column{
  flex:0 0 100%;
  width:100%;
  max-width:var(--post-board-max-w);
  padding:0;
  display:flex;
  flex-direction:column;
}

.post-images{
  margin-top:var(--gap);
  padding-top:0;
  width:100%;
  display:flex;
  flex-direction:column;
}

@media (max-width:440px){
  .main-post-column{
    flex:0 0 auto;
    width:100%;
    max-width:none;
  }
  .post-images .thumbnail-row{
    width:100%;
  }
}

.post-board .post-header{
  position:sticky;
  top:0;
  z-index:1;
}

.post-images .thumbnail-row{
  display:flex;
  width:100%;
  max-width:var(--post-board-max-w);
  box-sizing:border-box;
  padding:0 15px 10px 0;
  margin:0;
  gap:5px;
  overflow-x:auto;
  overflow-y:hidden;
  scrollbar-gutter:stable both-edges;
  justify-content:flex-start;
}

.post-images .thumbnail-row img{
  width:40px;
  height:40px;
  object-fit:cover;
  border-radius:8px;
  cursor:pointer;
  flex:0 0 auto;
}

.post-images .selected-image{
  width:100%;
  max-width:var(--post-board-max-w);
  aspect-ratio:1/1;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

.post-images .selected-image img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

.second-post-column{
  width:100%;
  max-width:100%;
  min-width:0;
  padding:0;
  display:flex;
  flex-direction:column;
  overflow:visible;
  height:auto;
  margin-top:0;
}

.post-venue-selection-container,
.post-session-selection-container{
  width:100%;
  height:auto;
  min-height:0;
  display:flex;
  flex-direction:column;
  gap:var(--gap);
}
.post-venue-selection-container:empty,
.post-session-selection-container:empty{
  display:none;
}

.post-details-title-container,
.post-details-member-container,
.post-details-info-container,
.post-details-description-container{
  width:100%;
  min-width:0;
}
.post-details-info-container{
  display:flex;
  flex-direction:column;
  gap:var(--gap);
}
.post-details-info-container > *{
  min-width:0;
}

.post-details-description-container{
  display:flex;
  flex-direction:column;
  gap:var(--gap);
}

.post-details-description-container .desc,
.post-details-description-container .desc-wrap{
  border:none;
  padding:0;
}

.post-details-description-container .desc{
  font-size:14px;
}

.ad-board{
  position:fixed;
  top:calc(var(--header-h) + var(--safe-top));
  bottom:var(--footer-h);
  right:0;
  width:440px;
  padding:10px;
  background:rgba(0,0,0,0);
  pointer-events:auto;
  z-index:2;
  transform:translateX(0);
  transition:transform 0.3s ease;
  display:none;
}

body.mode-map .ad-board{
  display:none !important;
}

body.hide-ads .ad-board{
  transform:translateX(100%);
  pointer-events:none;
  display:none;
}

@media (min-width:1900px){
  .ad-board{
    display:block;
  }
  body.hide-ads .ad-board{
    display:none;
  }
}

.ad-panel{
  width:100%;
  height:100%;
  position:relative;
  overflow:hidden;
  border-radius:8px;
}

.ad-panel .ad-slide{
  position:absolute;
  inset:0;
  opacity:0;
  transition:opacity 1.5s ease-in-out;
  cursor:pointer;
}

.ad-panel .ad-slide.active{opacity:1;}

.ad-panel .ad-slide img{
  width:100%;
  height:100%;
  object-fit:cover;
  animation:adZoom 20s linear forwards;
}

.ad-panel .ad-slide .info{
  position:absolute;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.5);
  color:#fff;
  padding:10px;
  text-shadow:0 0 4px #000;
}

@keyframes adZoom{
  from{transform:scale(1);}
  to{transform:scale(1.1);}
}

#filterBtn,
#memberBtn,
#adminBtn{
  gap:4px;
}
.header .view-toggle #filterBtn{
  height:40px;
  width:auto;
  padding:0 16px;
  border-radius:20px;
}
.icon-search{
  display:inline-block;
  vertical-align:middle;
  color: currentColor;
  width:30px; height:30px;
}
.mode-toggle{
  display:grid;
  grid-template-columns:repeat(3,40px);
  flex:0 1 auto;
  min-width:0;
  height:40px;
  border:1px solid var(--btn);
  border-radius:8px;
  overflow:hidden;
}
.mode-toggle button{
  width:40px;
  border:none;
  background:var(--btn);
  color:var(--button-text);
  font-weight:600;
  cursor:pointer;
  transition:background .2s,border-color .2s,color .2s;
  height:100%;
  border-radius:0;
  min-width:0;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:0;
  padding:0;
}
.mode-toggle .mode-icon{
  display:flex;
  align-items:center;
  justify-content:center;
  line-height:0;
  width:100%;
  height:100%;
}
.mode-toggle .mode-label{
  display:none;
  font-size:14px;
  line-height:1;
  white-space:nowrap;
}
.mode-toggle button svg{
  width:20px;
  height:20px;
}
.mode-toggle button + button{
  border-left:1px solid var(--btn);
}
.mode-toggle button[aria-pressed="true"]{
  background:var(--btn-selected);
  color:var(--button-active-text);
}
@media (min-width: 601px){
  .mode-toggle{
    grid-template-columns:repeat(3, auto);
  }
  .mode-toggle button{
    width:auto;
    padding:0 16px;
  }
  .mode-toggle .mode-icon{
    display:none;
  }
  .mode-toggle .mode-label{
    display:block;
  }
}
body.filters-active #filterBtn{
  background: var(--filter-active-color);
  border-color: var(--filter-active-color);
  }

.options-dropdown{ position:relative; }
.options-menu{ position:absolute; top:calc(100% + 4px); left:0; background:var(--dropdown-bg); color:var(--dropdown-text); border:1px solid var(--border); border-radius:var(--dropdown-radius); padding:10px; display:flex; flex-direction:column; gap:6px;  z-index:30; }
.options-menu[hidden]{ display:none; }
.options-menu label{ display:flex; align-items:center; gap:6px; white-space:nowrap; }

.card,
.recents-card,
.post-card{
  display: grid;
  grid-template-columns:90px 1fr 36px;
  gap:12px;
  align-items: flex-start;
  background-color: transparent;
  border: none;
  border-radius:8px;
  padding:12px;
  margin-bottom:12px;
  cursor:pointer;
}

.post-card{
  border:none;
  border-radius:8px;
  padding-top:10px;
  margin-top:10px;
}

.thumb{
  width: 90px;
  height: 70px;
  border-radius: 8px;
  object-fit: cover;
  display: block;
  background: var(--panel-bg);
  transition: filter .22s ease;
}

.thumb.lqip{
  filter: none;
}

.meta{
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 0;
}

.title{
  margin: 0;
  font-weight: bold;
  font-size: 16px;
  line-height: 1.2;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  line-clamp: 2;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.info{
  display: flex;
  gap: 16px;
  align-items: center;
  min-width: 0;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.quick-list-board .info{
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
  font-size: 13px;
}

.post-board .info{
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
  font-size: 13px;
}

.quick-list-board .info > div{
  display: flex;
  align-items: center;
  gap: 0;
}

.post-board .info > div{
  display: flex;
  align-items: center;
  gap: 0;
}

.badge{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  padding-right: 5px;
  border: 0;
  border-radius: 0;
  width: auto;
  height: auto;
  line-height: 1;
}

.info > div > :not(.badge) + *{
  margin-left: 5px;
}

.fav{
  width: 36px;
  height: 36px;
  border-radius: 8px;
  display: grid;
  place-items: center;
  background: var(--btn);
  border: 1px solid var(--btn);
}

.fav svg{
  width: 18px;
  height: 18px;
  fill: none;
  stroke: var(--gold);
  stroke-width: 1.5;
}

.fav[aria-pressed="true"] svg{
  fill: var(--gold);
  stroke: var(--gold);
}

.share{
  width: 36px;
  height: 36px;
  border-radius: 8px;
  display: grid;
  place-items: center;
  background: var(--btn);
  border: 1px solid var(--btn);
  margin-left: auto;
}

.share svg{
  width: 18px;
  height: 18px;
  fill: var(--button-text);
}

#favToggle{
  white-space:nowrap;
}
#favToggle svg{
  width:18px;
  height:18px;
  fill:none;
  stroke:var(--gold);
  stroke-width:1.5;
  vertical-align:middle;
  margin-left:6px;
}
#favToggle[aria-pressed="true"] svg{
  fill:var(--gold);
  stroke:var(--gold);
}

#map{
  position: absolute;
  inset: 0;
}

.map-overlay{
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  display: grid;
  place-items: center;
  color: #fff;
  font-weight: 700;
  letter-spacing: .5px;
  opacity: .15;
  pointer-events: none;
}

.map-control-row{
  display:flex;
  align-items:center;
  gap:var(--gap);
  flex-wrap:wrap;
}
.map-control-row .geocoder{
  background-color:#ffffff;
  border-radius:8px;
  flex:1 1 240px;
  min-width:0;
  width:100%;
  max-width:360px;
  display:flex;
}
#filterPanel .map-control-row .geocoder,
#filterPanel .map-control-row .mapboxgl-ctrl-geocoder,
#filterPanel .map-control-row .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--input{
  background-color:#ffffff;
  color:#000000;
}
#memberPanel .map-control-row .mapboxgl-ctrl-geolocate button,
#memberPanel .map-control-row .mapboxgl-ctrl-compass button{
  background-color:#ffffff !important;
  background-image:none !important;
  box-shadow:none !important;
}
#memberPanel .map-control-row .mapboxgl-ctrl-geolocate button svg,
#memberPanel .map-control-row .mapboxgl-ctrl-compass button svg{
  filter:none !important;
}
.map-control-row .mapboxgl-ctrl-geolocate button,
.map-control-row .mapboxgl-ctrl-compass button{
  width:35px;
  height:35px;
  border-radius:8px;
  background-color:#ffffff;
  border:1px solid rgba(0,0,0,0.15);
  box-shadow:none;
}

.mapboxgl-ctrl-geolocate button,
.mapboxgl-ctrl-compass button{
  width:35px !important;
  height:35px !important;
  background-color:#ffffff !important;
  border-radius:8px !important;
  border:1px solid rgba(0,0,0,0.15) !important;
  box-shadow:none !important;
}

.map-control-row .mapboxgl-ctrl-geolocate button:hover,
.map-control-row .mapboxgl-ctrl-compass button:hover{
  background-color:#f2f2f2;
}

.map-control-row .mapboxgl-ctrl-geolocate button svg,
.map-control-row .mapboxgl-ctrl-compass button svg{
  filter:none;
}

.map-control-row .mapboxgl-ctrl-geocoder{
  background:#ffffff;
  border-radius:8px;
  color:#000000;
  display:flex;
  align-items:center;
  gap:0;
  height:var(--geocoder-h);
  min-height:var(--geocoder-h);
  width:100%;
  max-width:100%;
  min-width:0;
}

.map-control-row .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--input{
  background:#ffffff;
  color:#000000;
  flex:1 1 auto;
  width:100%;
  height:100%;
  padding-top:0;
  padding-bottom:0;
  padding-left:12px;
  padding-right:12px;
  line-height:var(--geocoder-h);
}

.map-control-row .mapboxgl-ctrl-geocoder input.mapboxgl-ctrl-geocoder--input{
  height:100%;
}

.map-control-row .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--pin-right{
  display:none;
}

.map-control-row .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--button,
.map-control-row .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--icon,
.map-control-row .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--icon-loading,
.map-control-row .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--icon-search{
  display:none;
}

.panel-body .map-control-row:not(.map-controls-welcome){
  width:100%;
  max-width:100%;
  margin:0;
  justify-content:flex-start;
  background:none;
  border-radius:0;
  padding:0;
  box-sizing:border-box;
}
.panel-body .map-control-row:not(.map-controls-welcome) > *{
  flex:0 0 auto;
  width:auto;
  max-width:none;
  background:transparent;
  border-radius:8px;
  min-width:0;
}
.panel-body .map-control-row:not(.map-controls-welcome) > .geocoder{
  flex:1 1 auto;
}

#welcomeBody .map-control-row{
  justify-content:center;
  width:100%;
  max-width:100%;
  margin:0 auto;
  gap:10px;
  flex-wrap:wrap;
}
#welcomeBody .map-controls-welcome{
  pointer-events:auto;
}
#welcomeBody .map-control-row > *{
  flex:0 0 auto;
}
#welcomeBody .map-control-row > .geocoder{
  flex:1 1 240px;
  min-width:0;
  width:100%;
}
#welcomeBody .map-control-row .mapboxgl-ctrl-geocoder{
  width:100% !important;
  max-width:100% !important;
  min-width:0 !important;
}
#welcomeBody .map-controls-welcome .mapboxgl-ctrl-geocoder{
  display:flex;
  align-items:center;
  gap:0;
  height:var(--control-h);
}
#welcomeBody .map-controls-welcome .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--input{
  flex:1 1 auto;
  height:100%;
  padding-top:0;
  padding-bottom:0;
  padding-left:12px;
  padding-right:12px;
  line-height:var(--control-h);
}
#welcomeBody .map-controls-welcome .mapboxgl-ctrl-geocoder,
#welcomeBody .map-controls-welcome .mapboxgl-ctrl-geocoder *,
#welcomeBody .map-controls-welcome .mapboxgl-ctrl-geolocate,
#welcomeBody .map-controls-welcome .mapboxgl-ctrl-geolocate *{
  text-align:left;
}
#welcomeBody .map-controls-welcome .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--button{
  display:none;
}
#welcomeBody .map-controls-welcome .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--icon{
  display:none;
}
#welcomeBody .map-control-row .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--input{
  width:100%;
}

.mode-posts .map-controls-map{display:none;}

.map-controls-map{
  position:absolute;
  left:50%;
  top:calc(var(--header-h) + 10px);
  transform:translateX(-50%);
  width:min(600px, 90vw);
  max-width:90vw;
  z-index:1;
}

.map-controls-map .geocoder{
  max-width:100%;
}

.map-control-row .geocoder{margin:0;}

.post-board .posts{
  flex:1 1 auto;
  min-height:0;
  overflow-y:auto;
  overflow-y:overlay;
  overflow-x:hidden;
  padding:0;
  margin:0;
}
.post-board .posts,
.recents-board{
  scrollbar-width:thin;
  scrollbar-color:rgba(255,255,255,0.4) rgba(0,0,0,0);
}
.post-board .posts::-webkit-scrollbar,
.recents-board::-webkit-scrollbar{
  width:8px;
  height:8px;
}
.post-board .posts::-webkit-scrollbar-track,
.recents-board::-webkit-scrollbar-track{
  background-color:rgba(0,0,0,0);
}
.post-board .posts::-webkit-scrollbar-thumb,
.recents-board::-webkit-scrollbar-thumb{
  background-color:rgba(255,255,255,0.4);
  border-radius:999px;
}
.post-board .posts::-webkit-scrollbar-corner,
.recents-board::-webkit-scrollbar-corner{
  background-color:rgba(0,0,0,0);
}
.post-board{color:#fff;}
.post-board .post-card,
.post-board .open-post{
  background-color:transparent;
  margin:0;
  border:none;
  border-radius:0;
  border-bottom:1px solid rgba(255,255,255,0.12);
}
.post-board .post-card:last-child,
.post-board .open-post:last-child{border-bottom:none;}
.post-board > *:last-child{margin-bottom:0 !important;}
.post-board .post-card .thumb{border-radius:8px;}
.post-board button{background:var(--btn);border-color:var(--btn);color:var(--ink);}

.post-board-empty{
  padding:20px 16px;
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:0;
}

.post-board-empty-summary{
  margin:0 0 10px;
  width:100%;
  max-width:var(--post-board-max-w);
}

.post-board-empty-image{
  margin-top:10px;
  width:auto;
  max-width:100%;
  height:auto;
  border-radius:8px;
}

.post-board-empty-message{
  margin:10px 0 0;
}

.recents-board-reminder{
  margin:10px 0 20px;
  padding:0 12px;
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
}

.recents-board-reminder img{
  max-width:100%;
  height:auto;
  border-radius:8px;
}

.recents-board-reminder p{
  margin:0;
}

.mode-posts .post-board{
  left:0;
  opacity:1;
  z-index:1;
  pointer-events:auto;
}

.mode-map .post-board{
  left:calc(-100vw - var(--filter-panel-offset));
  opacity:0;
  pointer-events:none;
}
.map-area{
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 0;
}

.open-post{
  border:none;
  border-radius:0;
  margin:0;
  padding-top:0;
  overflow:visible;
  color:#fff;
  font-size:14px;
  display:flex;
  flex-direction:column;
  gap:0;
  position:relative;
}

.open-post .post-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  opacity:1;
  border-top-left-radius:inherit;
  border-top-right-radius:inherit;
  position:sticky;
  top:0;
  z-index:3;
  background:transparent;
  pointer-events:none;
}
.open-post .post-header button,
.open-post .post-header [role="button"],
.open-post .post-header a{
  pointer-events:auto;
}
.post-card .post-header{
  background-color:transparent;
}
.open-post .post-header .share{margin-left:auto;margin-right:var(--gap);}

.open-post .post-body{
  padding:0 0 10px;
  display:flex;
  flex-direction:row;
  flex-wrap:wrap;
  gap:var(--gap);
  align-items:flex-start;
  align-content:flex-start;
}
.open-post .post-body > .main-post-column{
  flex:0 0 var(--post-board-max-w);
  max-width:var(--post-board-max-w);
  width:var(--post-board-max-w);
}
.open-post .post-body > .second-post-column{
  flex:1 1 100%;
  max-width:100%;
  width:100%;
}

.open-post .post-details{
  margin-top:0;
  width:calc(100% - 20px);
  max-width:calc(100% - 20px);
  min-width:0;
  display:flex;
  flex-direction:column;
  gap:var(--gap);
  padding:10px 0;
  flex:1 1 auto;
  box-sizing:border-box;
  margin-left:auto;
  margin-right:auto;
}

.open-post:not(.desc-expanded) .post-venue-selection-container,
.open-post:not(.desc-expanded) .post-session-selection-container,
.open-post:not(.desc-expanded) .location-section,
.open-post:not(.desc-expanded) .post-details-info-container,
.open-post:not(.desc-expanded) .member-avatar-row{
  display:none;
}

.open-post .post-details .info{
  color: inherit;
  font-size: inherit;
}

.open-post .post-images{
  display:flex;
  flex-direction:column;
  gap:5px;
  width:100%;
  max-width:var(--post-board-max-w);
  flex:0 0 100%;
  box-sizing:border-box;
  margin:0 auto;
  align-self:center;
}

.open-post.desc-expanded .post-images,
body.open-post-sticky-images .open-post.desc-expanded .post-images{
  position:static;
}

.open-post.desc-expanded .post-images{
  margin-top:var(--gap);
}

.open-post-sticky-images .open-post .post-images{
  position:sticky;
  top:var(--open-post-header-h,0px);
  align-self:start;
}

.open-post .image-box{
  width:100%;
  max-width:100%;
  aspect-ratio:1/1;
  height:auto;
  min-height:0;
  overflow:hidden;
  border:none;
  border-radius:0;
  flex-shrink:0;
  cursor:pointer;
  background: rgba(0,0,0,0);
  position:relative;
}

.open-post .image-box .image-track{
  display:flex;
  width:100%;
  height:100%;
  gap:0;
  align-items:stretch;
  transition:transform 0.35s ease;
  will-change:transform;
  touch-action: pan-y;
}

.open-post .image-box img{
  width:100%;
  height:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  object-position:center;
  display:block;
  flex:0 0 100%;
}
.open-post .image-box img.ready{
  object-fit:cover;
}

.open-post .thumbnail-row{
  position:relative;
}

.open-post .thumbnail-row img{
  width:50px;
  height:50px;
  object-fit:cover;
  object-position:center;
  aspect-ratio:1/1;
  border:1px solid var(--border);
  border-radius:8px;
  cursor:pointer;
  position:relative;
  z-index:1;
}

@media (max-width: 440px){
  .post-board .posts{padding:0;}
  .post-board .post-card{
    grid-template-columns:80px 1fr 36px;
    gap:12px;
    padding:12px;
    margin:10px 0 12px;
    border-radius:0;
  }
  .post-board .post-card .thumb{
    width:80px;
    height:80px;
  }
  .post-board .post-card .meta{padding:0;}
  .open-post{
    margin:10px 0 12px;
  }
  .post-board .post-card:last-child,
  .post-board .open-post:last-child{
    margin-bottom:0;
  }
  .open-post .post-body{
    padding:0;
  }
  .open-post .post-header{
    padding:10px;
  }
  .open-post .post-images,
  .open-post .venue-dropdown,
  .open-post .session-dropdown,
  .open-post .post-details{
    margin-bottom:var(--gap);
  }
  .open-post .post-details{
    margin-bottom:0;
  }
  .open-post .post-images{
    flex:1 1 100%;
    width:100%;
  }
  .open-post .image-box{
    width:100%;
    max-width:100%;
    aspect-ratio:1/1;
    height:auto;
    margin:0;
    border-radius:0;
    position:relative;
    overflow:hidden;
  }
  .open-post .image-box .image-track{
    display:flex;
    width:100%;
    height:100%;
    gap:0;
    align-items:stretch;
    transition:transform 0.35s ease;
    will-change:transform;
    touch-action: pan-y;
  }
  .open-post .image-box img{
    width:100%;
    height:100%;
    aspect-ratio:1/1;
    object-fit:cover;
    object-position:center;
    flex:0 0 100%;
  }
  .open-post .thumbnail-row{
    width:100%;
    max-width:100%;
  }
  .open-post .venue-dropdown,
  .open-post .session-dropdown{
    width:100%;
    max-width:100%;
    padding:0;
  }
  .second-post-column .venue-dropdown,
  .second-post-column .session-dropdown{
    width:100%;
    max-width:100%;
    padding:0;
  }
  .open-post .venue-dropdown,
  .open-post .session-dropdown,
  .second-post-column .venue-dropdown,
  .second-post-column .session-dropdown{
    min-width:0;
    width:100%;
    max-width:100%;
  }
}

.open-post .post-header .title{
  margin:0;
  font-size:16px;
  font-weight:bold;
  line-height:1.2;
  color:#fff;
}

.open-post .post-header .title-block{
  display:flex;
  flex-direction:column;
}

.open-post .post-header .cat-line{
  font-size:14px;
  margin-top:4px;
  display:flex;
  align-items:center;
}

.open-post .meta{
  font-size:14px;
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.open-post .member-avatar-row,
.second-post-column .member-avatar-row{
  display:none;
  align-items:center;
  height:50px;
  gap:10px;
  margin:var(--gap) 0 0;
}
.open-post.desc-expanded .member-avatar-row,
.open-post.desc-expanded .second-post-column .member-avatar-row{
  display:flex;
}
.open-post .member-avatar-row img,
.second-post-column .member-avatar-row img{
  width:50px;
  height:50px;
  object-fit:cover;
}

.open-post .member-avatar-row span,
.second-post-column .member-avatar-row span{
  padding-left:10px;
}

.second-post-column .desc-wrap{
  width:100%;
}

.second-post-column .desc{
  display:-webkit-box;
  -webkit-line-clamp:2;
  line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  text-overflow:ellipsis;
  cursor:pointer;
  white-space:normal;
}

.second-post-column .desc:focus{
  outline:none;
}

.second-post-column .desc.expanded{
  display:block;
  -webkit-line-clamp:unset;
  line-clamp:unset;
  overflow:visible;
  text-overflow:unset;
}

.open-post .location-section,
.second-post-column .location-section{
  display:flex;
  flex-direction:column;
  gap:var(--gap);
  margin:0;
}

.open-post .venue-dropdown,
.open-post .session-dropdown,
.second-post-column .venue-dropdown,
.second-post-column .session-dropdown{
  position:relative;
  width:100%;
  max-width:100%;
  min-width:0;
}

.venue-options,
.session-options{
  display:flex;
  flex-direction:column;
  gap:var(--gap);
  width:100%;
  flex:1 1 auto;
  max-height:250px;
  overflow-y:auto;
}

.open-post .venue-menu .map-container,
.second-post-column .venue-menu .map-container{
  position:relative;
  width:100%;
  border-radius:8px;
  overflow:hidden;
  background:var(--dropdown-bg);
  min-height:200px;
  flex:0 0 auto;
}

.open-post .venue-menu .post-map,
.second-post-column .venue-menu .post-map{
  width:100%;
  height:200px;
  min-height:200px;
  border:none;
  border-radius:8px;
}

.post-map{
  border-radius:8px;
}

.open-post .venue-dropdown > button,
.second-post-column .venue-dropdown > button{
  height:50px;
  background:var(--btn);
  border:1px solid var(--btn);
  border-radius:var(--dropdown-radius);
  text-align:left;
  padding:2px 8px;
  color:var(--button-text);
  display:inline-flex;
  flex-direction:column;
  align-items:flex-start;
  justify-content:center;
  width:100%;
}

.open-post .session-dropdown > button,
.second-post-column .session-dropdown > button{
  height:50px;
  background:var(--btn);
  border:1px solid var(--btn);
  border-radius:var(--dropdown-radius);
  text-align:left;
  padding:2px 8px;
  color:var(--button-text);
  display:inline-flex;
  align-items:center;
  justify-content:flex-start;
  width:100%;
}

.open-post .venue-dropdown > button .venue-name,
.second-post-column .venue-dropdown > button .venue-name{
  font-weight:bold;
  display:block;
}

.open-post .venue-dropdown > button .venue-address,
.second-post-column .venue-dropdown > button .venue-address{
  display:block;
}

.open-post .venue-menu button .venue-name,
.second-post-column .venue-menu button .venue-name{
  font-weight:bold;
  display:block;
}

.open-post .venue-menu button .venue-address,
.second-post-column .venue-menu button .venue-address{
  display:block;
}

.open-post .venue-dropdown > button .venue-name,
.second-post-column .venue-dropdown > button .venue-name,
.open-post .venue-dropdown > button .venue-address,
.second-post-column .venue-dropdown > button .venue-address,
.open-post .venue-menu button .venue-name,
.second-post-column .venue-menu button .venue-name,
.open-post .venue-menu button .venue-address,
.second-post-column .venue-menu button .venue-address{
  line-height:1.2;
}

.open-post .venue-menu,
.open-post .session-menu,
.second-post-column .venue-menu,
.second-post-column .session-menu{
  position:absolute;
  top:calc(100% + 4px);
  left:0;
  width:100%;
  min-width:0;
  box-sizing:border-box;
  max-width:100%;
  max-height:min(80vh, calc(100vh - (var(--header-h) + var(--safe-top) + 20px)));
  overflow:auto;
  background:var(--dropdown-bg);
  border:1px solid var(--border);
  border-radius:var(--dropdown-radius);
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:30;
}
.open-post .venue-menu,
.open-post .session-menu{
  max-width:100%;
}
.second-post-column .venue-menu,
.second-post-column .session-menu{
  max-width:100%;
}

.open-post .venue-menu[hidden],
.open-post .session-menu[hidden],
.second-post-column .venue-menu[hidden],
.second-post-column .session-menu[hidden]{display:none;}

.open-post .venue-menu button,
.second-post-column .venue-menu button{
  height:50px;
  background:var(--btn);
  border:1px solid var(--btn);
  border-radius:var(--dropdown-radius);
  text-align:left;
  padding:4px 8px;
  color:var(--button-text);
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  justify-content:center;
  width:100%;
}

.open-post .session-menu button,
.second-post-column .session-menu button{
  height:50px;
  background:var(--btn);
  border:1px solid var(--btn);
  border-radius:var(--dropdown-radius);
  text-align:left;
  padding:4px 8px;
  color:var(--button-text);
  display:flex;
  align-items:center;
  justify-content:flex-start;
}

.open-post .venue-menu,
.open-post .session-menu,
.second-post-column .venue-menu,
.second-post-column .session-menu,
.sort-options{
  --button-selected-bg: #2e3a72;
  --button-selected-border: #2e3a72;
  --button-selected-text: var(--button-active-text);
  --button-selected-hover: #2e3a72;
  --button-selected-hover-border: #2e3a72;
  --button-selected-hover-text: var(--button-active-text);
  --button-selected-active: #2e3a72;
  --button-selected-active-border: #2e3a72;
  --button-selected-active-text: var(--button-active-text);
}

.open-post .venue-menu button.selected,
.open-post .session-menu button.selected,
.second-post-column .venue-menu button.selected,
.second-post-column .session-menu button.selected{
  background:#2e3a72;
  color:var(--button-active-text);
  border-color:#2e3a72;
}

.open-post .session-menu button .session-time,
.second-post-column .session-menu button .session-time{
  margin-left:auto;
  padding-right:20px;
}
.open-post .session-dropdown > button .session-time,
.second-post-column .session-dropdown > button .session-time{
  margin-left:auto;
  padding-right:20px;
}

.open-post .location-section .options-menu,
.second-post-column .location-section .options-menu{
  width:100%;
  box-sizing:border-box;
}

.hide-map-calendar .open-post .map-container,
.hide-map-calendar .open-post .calendar-container,
.hide-map-calendar .second-post-column .map-container,
.hide-map-calendar .second-post-column .calendar-container{
  display:none;
}

.open-post .post-calendar,
.second-post-column .post-calendar,
.second-post-column .post-calendar{
  position:relative;
  font-size:var(--panel-label-size);
  min-width:var(--calendar-width);
  width:max-content;
}

.open-post .session-menu .calendar-container,
.second-post-column .session-menu .calendar-container{
  display:flex;
  flex-direction:column;
  gap:var(--gap);
  position:relative;
  width:100%;
  min-width:0;
  height:auto;
  border-radius:8px;
  overflow:hidden;
  background:var(--dropdown-bg);
  min-height:200px;
  flex:0 0 auto;
}

.open-post .calendar-container .calendar-scroll,
.second-post-column .calendar-container .calendar-scroll{
  width:100%;
  min-height:var(--calendar-height);
  height:auto;
  max-height:none;
  display:flex;
  align-items:stretch;
  overflow-x:auto;
  overflow-y:hidden;
  padding-bottom:var(--scrollbar-h);
  box-sizing:content-box;
  background:var(--dropdown-bg);
  border:none;
  border-radius:8px;
  display:flex;
  align-items:stretch;
  flex:1 1 auto;
  max-width:100%;
  margin-bottom:0;
  scrollbar-gutter: stable both-edges;
}
.open-post .post-calendar .calendar,
.second-post-column .post-calendar .calendar,
.second-post-column .post-calendar .calendar{
  margin:0;
  box-sizing:border-box;
  display:flex;
  flex-direction:row;
  align-items:flex-start;
  width:max-content;
  height:var(--calendar-height);
  transform:scale(var(--calendar-scale));
  transform-origin:top left;
  background:var(--dropdown-bg);
  color:var(--dropdown-text);
  font-size:inherit;
}
.open-post .post-calendar .month,
.second-post-column .post-calendar .month,
.second-post-column .post-calendar .month{
  flex:0 0 auto;
  width:var(--calendar-width);
  min-width:var(--calendar-width);
  height:var(--calendar-height);
  display:flex;
  flex-direction:column;
}
.open-post .post-calendar .month:not(:first-child),
.second-post-column .post-calendar .month:not(:first-child),
.second-post-column .post-calendar .month:not(:first-child){
  border-left:1px solid var(--calendar-past-bg);
}
.open-post .post-calendar .grid,
.second-post-column .post-calendar .grid,
.second-post-column .post-calendar .grid{
  flex:1 1 auto;
  width:100%;
  height:calc(var(--calendar-height) - var(--calendar-header-h));
  display:grid;
  grid-template-columns:repeat(7,var(--calendar-cell-w));
  grid-template-rows:repeat(7,var(--calendar-cell-h));
}
.open-post .post-calendar .calendar-header,
.second-post-column .post-calendar .calendar-header,
.second-post-column .post-calendar .calendar-header{
  height:var(--calendar-header-h);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-weight:bold;
  line-height:var(--calendar-header-h);
  background:#2e3a72;
  color:#fff;
  font-size:inherit;
}
.open-post .post-calendar .weekday,
.open-post .post-calendar .day,
.second-post-column .post-calendar .weekday,
.second-post-column .post-calendar .day,
.second-post-column .post-calendar .weekday,
.second-post-column .post-calendar .day{
  width:var(--calendar-cell-w);
  height:var(--calendar-cell-h);
  line-height:var(--calendar-cell-h);
  text-align:center;
  font-size:inherit;
}
.open-post .post-calendar .weekday,
.second-post-column .post-calendar .weekday,
.second-post-column .post-calendar .weekday{
  font-weight:bold;
  color:var(--dropdown-text);
}
.open-post .post-calendar .day,
.second-post-column .post-calendar .day,
.second-post-column .post-calendar .day{
  cursor:pointer;
  background:var(--calendar-future-bg);
  color:var(--dropdown-text);
  transition:background .2s,color .2s;
}
.open-post .post-calendar .day.empty,
.second-post-column .post-calendar .day.empty,
.second-post-column .post-calendar .day.empty{
  cursor:default;
  background:var(--calendar-future-bg);
  color:var(--dropdown-text);
  opacity:0.6;
}
.open-post .post-calendar .day.available-day,
.second-post-column .post-calendar .day.available-day,
.second-post-column .post-calendar .day.available-day{
  background:var(--session-available);
  color:#fff;
}
.open-post .post-calendar .day.available-day:hover,
.second-post-column .post-calendar .day.available-day:hover,
.second-post-column .post-calendar .day.available-day:hover{
  background:var(--session-available);
  color:#fff;
}
.open-post .post-calendar .day.selected,
.second-post-column .post-calendar .day.selected,
.second-post-column .post-calendar .day.selected{
  background:var(--session-selected);
  color:#fff;
}
.open-post .post-calendar .day.selected:hover,
.second-post-column .post-calendar .day.selected:hover,
.second-post-column .post-calendar .day.selected:hover{
  background:var(--session-selected);
  color:#fff;
}
.open-post .post-calendar .day.today,
.second-post-column .post-calendar .day.today,
.second-post-column .post-calendar .day.today{color:var(--today) !important;}
.open-post .post-calendar .day.available-day.today,
.open-post .post-calendar .day.available-day.selected.today,
.open-post .post-calendar .day.selected.today,
.second-post-column .post-calendar .day.available-day.today,
.second-post-column .post-calendar .day.available-day.selected.today,
.second-post-column .post-calendar .day.selected.today,
.second-post-column .post-calendar .day.available-day.today,
.second-post-column .post-calendar .day.available-day.selected.today,
.second-post-column .post-calendar .day.selected.today{color:var(--today) !important;}

.open-post .post-calendar .selected-month-name,
.second-post-column .post-calendar .selected-month-name,
.second-post-column .post-calendar .selected-month-name{
  background:var(--accent);
  color:var(--button-hover-text);
  border-radius:8px;
  padding:0 4px;
}

.open-post .calendar-container .time-popup,
.second-post-column .calendar-container .time-popup{
  position:absolute;
  z-index:10;
}

.open-post .calendar-container .time-popup .time-list,
.second-post-column .calendar-container .time-popup .time-list{
  background:var(--dropdown-bg);
  color:var(--dropdown-text);
  padding:8px;
  border-radius:8px;
  display:flex;
  flex-direction:column;
  gap:4px;
   }

.open-post .calendar-container .time-popup .time-list button,
.second-post-column .calendar-container .time-popup .time-list button{
  background:var(--btn);
  border:1px solid var(--btn);
  color:var(--button-text);
  border-radius:8px;
  padding:6px 10px;
  cursor:pointer;
}

.open-post .venue-info,
.open-post .session-info,
.second-post-column .venue-info,
.second-post-column .session-info{
  color: inherit;
  font-size: inherit;
}
.open-post .venue-info,
.second-post-column .venue-info{margin-top:4px;}
.open-post .session-info,
.second-post-column .session-info{margin-top:8px;}

.img-popup{
  position:fixed;
  inset:0;
  background:var(--image-panel-bg);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:4000;
  pointer-events:auto;
}
.img-popup img{
  max-width:90vw;
  max-height:90vh;
  cursor:pointer;
  pointer-events:auto;
}

.pill{
  border: 1px solid var(--btn);
  background: var(--btn);
  border-radius: 999px;
  padding: 8px 12px;
  font-weight: 700;
  cursor: pointer;
}

.close{
  border: 0;
  background: #16283f;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
}

.dates{
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 4px;
}

.date{
  background: var(--btn);
  border: 1px solid var(--btn);
  border-radius: 999px;
  padding: 6px 10px;
  font-size: 14px;
}

.desc{
  margin-top:8px;
  cursor:pointer;
  font-size:14px;
}

@media (max-width:440px){
  html{
    touch-action:pan-x pan-y;
  }
  .map-container{
    touch-action:auto;
  }
  .img-popup img{
    touch-action:pinch-zoom;
  }
}

@media (max-width:440px){
  .post-mode-boards{
    top:calc(var(--header-h) + var(--safe-top));
    bottom:var(--footer-h);
    padding:0;
    gap:0;
    flex-direction:column;
    align-items:flex-start;
  }
  .quick-list-board,
  .post-board,
  .recents-board{
    width:100%;
    max-width:100%;
    left:0;
    right:0;
    padding:0;
    border-radius:0;
    flex:0 0 auto;
    min-height:0;
    height:auto;
    max-height:100%;
  }
  .quick-list-board{
    position:relative;
    top:0;
    bottom:auto;
  }
  .panel-content{
    top:calc(var(--header-h) + var(--safe-top));
    bottom:var(--footer-h);
    height:calc(100vh - var(--header-h) - var(--safe-top) - var(--footer-h));
    min-height:0;
  }
  .card,
  .recents-card,
  .post-card{
    margin:0;
    border-radius:0;
    padding:12px;
  }
  .post-board .post-card,
  .recents-board .recents-card{
    margin:0;
    border-radius:0;
  }
  .thumb,
  .recents-card .thumb{
    border-radius:0;
  }
  .post-card .thumb{
    border-radius:8px;
  }
  .post-board .post-card,
  .recents-board .recents-card{
    border-bottom:1px solid rgba(255,255,255,0.12);
  }
  .post-board .post-card:last-child,
  .recents-board .recents-card:last-child{
    border-bottom:none;
  }
  .panel-content{
    left:0 !important;
    right:0 !important;
    top:calc(var(--header-h) + var(--safe-top));
    bottom:var(--footer-h);
    width:100% !important;
    max-width:100% !important;
    height:calc(100vh - var(--header-h) - var(--safe-top) - var(--footer-h));
    max-height:calc(100vh - var(--header-h) - var(--safe-top) - var(--footer-h));
    border-radius:0;
  }
  .panel-body{
    padding:10px;
    align-items:stretch;
  }
  .panel-body > *{
    max-width:100%;
  }
  #filterPanel .panel-body{
    padding:10px;
  }
  #filterPanel .panel-body > *{
    max-width:100%;
  }
  .post-details-description-container .desc-wrap{
    margin:10px 0 0;
  }
  .post-details-description-container .desc{
    margin:0;
  }
  .post-details-description-container .desc[aria-expanded="false"]{
    display:-webkit-box;
    -webkit-line-clamp:2;
    line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .post-details-description-container .desc[aria-expanded="true"],
  .post-details-description-container .desc.expanded{
    display:block;
  }
  .post-images{
    margin-top:10px;
  }
  .open-post .image-box{
    width:100%;
    max-width:100%;
    aspect-ratio:1/1;
    margin:0;
    border-radius:0;
    display:block;
    overflow:hidden;
    position:relative;
  }
  .open-post .image-box .image-track{
    display:flex;
    width:100%;
    height:100%;
    gap:0;
    align-items:stretch;
    transition:transform 0.35s ease;
    will-change:transform;
    touch-action: pan-y;
  }
  .open-post .image-box img{
    border-radius:0;
    width:100%;
    height:100%;
    aspect-ratio:1/1;
    object-fit:cover;
    display:block;
    flex:0 0 100%;
  }
  .open-post .thumbnail-row img{
    width:60px;
    height:60px;
    border-radius:8px;
  }
}

@media (max-width:440px){
  .open-post .post-body{
    flex-direction:column;
    gap:var(--gap);
  }
  .open-post .post-body > .main-post-column,
  .open-post .post-body > .second-post-column{
    flex:1 1 100%;
    max-width:100%;
    width:100%;
  }
  .open-post .location-section,
  .second-post-column .location-section{
    flex-direction:column;
  }
  .open-post .post-details .location-section,
  .second-post-column .post-details .location-section{
    order:-1;
  }
  .open-post .image-box{
    max-width:100%;
    width:100%;
    aspect-ratio:1/1;
    height:auto;
    display:block;
    position:relative;
    overflow:hidden;
  }
    .open-post .image-box .image-track{
      display:flex;
      width:100%;
      height:100%;
      gap:0;
      align-items:stretch;
      transition:transform 0.35s ease;
      will-change:transform;
      touch-action: pan-y;
    }
    .open-post .image-box img{
      width:100%;
      height:100%;
      aspect-ratio:1/1;
      flex:0 0 100%;
    }
  .open-post .venue-dropdown,
  .open-post .session-dropdown,
  .second-post-column .venue-dropdown,
  .second-post-column .session-dropdown{
    display:block;
  }
}

  @media (max-width:440px){
    .post-board,
    .post-board .post-card,
    .open-post{
      width:100%;
      max-width:100%;
      border:none;
      border-radius:0;
    }
    .post-board,
    .open-post{
      min-width:0;
    }
    .open-post .image-box{
      width:100%;
      max-width:100%;
      aspect-ratio:1/1;
      height:auto;
      max-height:none;
      margin:0;
      padding:0;
      border:none;
      border-radius:0;
      display:block;
      overflow:hidden;
      position:relative;
    }
    .open-post .image-box .image-track{
      display:flex;
      width:100%;
      height:100%;
      gap:0;
      align-items:stretch;
      transition:transform 0.35s ease;
      will-change:transform;
      touch-action: pan-y;
    }
    .open-post .image-box img{
      width:100%;
      height:100%;
      object-fit:cover;
      margin:0;
      border-radius:0;
      aspect-ratio:1/1;
      flex:0 0 100%;
    }
    .open-post .post-body{
      padding:0;
      gap:0;
    }
    .open-post .post-details{
      padding:10px 0;
    }
  }

@media (max-width:440px){
  .open-post .venue-dropdown > button,
  .open-post .session-dropdown > button{
    height:50px;
  }
}

  .fullscreen-btn{
    width:35px;
    height:35px;
    padding:0;
    flex:0 0 auto;
  }

  .copy-msg{ 
    position:absolute;
    background:rgba(0,0,0,0.8);
    color:#fff;
    padding:4px 8px;
    border-radius:8px;
    opacity:0;
    transition:opacity .3s;
    pointer-events:none;
  }
  .copy-msg.show{opacity:1;}

  .image-modal-container{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.7);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:3000;
  }
  .image-modal-container.hidden{display:none;}
  .image-modal-container .image-modal img{
    max-width:90vw;
    max-height:90vh;
    display:block;
  }

  #post-modal-container{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.7);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:3000;
  }
  #post-modal-container.hidden{display:none;}
    #post-modal-container .post-modal{
      width:880px;
    max-width:100%;
    height:90%;
    overflow:auto;
    overflow:overlay;
    background:var(--list-background);
    border-radius:8px;
  }
    @media (max-width:440px){
      #post-modal-container .post-modal{width:440px;}
    }
    @media (max-width:440px){
      #post-modal-container .post-modal{width:100%;min-width:0;}
    }

  .chip-small{
  flex: 0 0 auto;
  max-width: 240px;
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--btn);
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  cursor: pointer;
}

.chip-small img.mini{
  width: 26px;
  height: 20px;
  border-radius: 8px;
  object-fit: cover;
  flex: 0 0 auto;
  display: block;
  background: var(--btn);
}

.chip-small .t{
  overflow: hidden;
  text-overflow: ellipsis;
}

.card .thumb,
.recents-card .thumb,
.post-card .thumb{
  flex: 0 0 80px;
  width: 80px;
  height: 80px;
  display: block;
  object-fit: cover;
  border-radius: 8px;
}

.card .meta,
.recents-card .meta,
.post-card .meta{
  flex: 1 1 auto;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.post-card,
.post-card *,
.recents-card,
.recents-card *{
  cursor: pointer;
}

.card .fav,
.recents-card .fav,
.post-card .fav{
  flex: 0 0 auto;
}

.recents-card[aria-selected="true"]{
  position:relative;
  z-index:0;
  background:none;
}

.recents-card[aria-selected="true"]::before{
  content:"";
  position:absolute;
  inset:0;
  background-color:#2e3a72;
  border-radius:8px;
  z-index:-1;
}

.hover-card{
  display: flex;
  gap: 10px;
  align-items: flex-start;
  max-width: 400px;
  cursor: pointer;
}

.hover-card img{
  width: 64px;
  height: 64px;
  object-fit: cover;
  border-radius: 8px;
  flex: 0 0 auto;
  display: block;
  background: var(--panel-bg);
}

.hover-card .t{
  font-weight: bold;
  font-size: 16px;
  line-height: 1.25;
  white-space: normal;
  word-break: break-word;
  overflow-wrap: anywhere;
  display: -webkit-box;
  line-clamp: 3;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 3;
  overflow: hidden;
}

.hover-card .s{
  font-size: 14px;
  opacity: .8;
  margin-top: 2px;
  white-space: normal;
  word-break: break-word;
  overflow-wrap: anywhere;
  display: -webkit-box;
  line-clamp: 1;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 1;
  overflow: hidden;
}

.multi-hover h4{
  margin: 0 0 8px 0;
  font-size: 16px;
  color: var(--ink-d);
  font-weight: bold;
  letter-spacing: .3px;
}

.multi-list{
  max-height: 360px;
  overflow-y: auto;
  overflow-y: overlay;
  overflow-x: hidden;
  padding: 2px 6px 2px 2px;
  box-sizing: border-box;
}

.multi-item.map-card{
  display: flex;
  gap: 8px;
  align-items: center;
  padding: 4px 6px;
  border-radius: 8px;
  cursor: pointer;
  min-width: 0;
  box-sizing: border-box;
}

.multi-item.map-card img{
  width: 64px;
  height: 64px;
  aspect-ratio: 1 / 1;
  border-radius: 8px;
  object-fit: cover;
  display: block;
  background: var(--panel-bg);
  flex: 0 0 64px;
  min-width: 64px;
  min-height: 64px;
}

.multi-item.map-card .t{
  white-space: normal;
  overflow-wrap: anywhere;
  display: -webkit-box;
  line-clamp: 2;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.multi-item.map-card .s{
  font-size: 14px;
  opacity: .8;
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.mapboxgl-popup,
.mapboxgl-popup-content{
  border-radius:8px !important;
}

.mapboxgl-popup-content{
  background: var(--popup-bg) !important;
  color: var(--popup-text) !important;
  overflow:hidden;
}

.mapboxgl-popup.map-card .mapboxgl-popup-content{
  overflow: visible;
}

.mapboxgl-popup-close-button{
  color: var(--popup-text) !important;
}

.multi-ctrls{
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  margin-top: 8px;
}

.multi-ctrls .hint{
  font-size: 14px;
  color: var(--ink-d);
}

.multi-ctrls .close{
  border: 0;
  background: #16283f;
  color: #fff;
  border-radius: 8px;
  padding: 6px 10px;
  cursor: pointer;
}

.multi-item.map-card > div{
  min-width: 0;
}

.multi-item.map-card .hover-card{
  width: 100%;
}

.hover-card > div{
  min-width: 0;
  flex: 1;
}

.multi-item.map-card .hover-card .t{
  max-width: none;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

.nowrap{
  white-space: nowrap;
}

.multi-hover .soonest{
  color: var(--ink-d);
  font-weight: 600;
}

@media (max-width:600px){
  .mapboxgl-popup.map-card .multi-hover,
  .mapboxgl-popup.map-card .multi-list,
  .mapboxgl-popup.map-card .multi-item.map-card{
    width: 90vw;
    max-width: 90vw;
  }
  .mapboxgl-popup.map-card .multi-item.map-card .hover-card{
    max-width: 100%;
  }
}

.hero img.lqip{
  filter: blur(10px);
  transform: scale(1.02);
  transition: filter .22s ease, transform .22s ease;
}

.hero img.ready{
  filter: none;
  transform: none;
}

.hover-card img{
  width: 64px;
  height: 64px;
  object-fit: cover;
  border-radius: 8px;
  flex: 0 0 auto;
  display: block;
  background: var(--panel-bg);
}

img.thumb{
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 8px;
}

#results .recents-card > img, #results .recents-card img.thumb{
  width: 80px;
  height: 80px;
  aspect-ratio: 1/1;
  object-fit: cover;
  display: block;
  border-radius: 8px;
}

.mode-posts #postsWide{
  border: none;
  background: transparent;
}

.mode-posts #postsWide.posts{
  background: transparent;
}

@media (max-width:440px){
  #filterPanel .panel-content{
    top:calc(var(--header-h) + var(--safe-top));
    left:0;
    right:0;
    bottom:var(--footer-h);
    width:100%;
    max-width:none;
    max-height:none;
    border-radius:0;
    padding-bottom:10px;
  }
  #filterPanel .panel-content .resizer{
    display:none;
  }
}

@media (max-width:440px){
  .post-board .posts{
    padding:0;
    margin:0;
  }
  .post-board .post-card{
    width:100%;
    margin:0;
    border-radius:0;
  }
  .post-board .open-post{
    margin:0;
  }
  .open-post{
    width:100%;
    border-radius:0;
    margin:0;
  }
  .open-post .post-images{
    flex:0 0 100%;
    width:100%;
  }
  .open-post .post-details{
    width:calc(100% - 20px);
    max-width:calc(100% - 20px);
    min-width:0;
    padding:10px 0;
    margin-left:auto;
    margin-right:auto;
  }
  .open-post .image-box{
    width:100%;
    max-width:100%;
    aspect-ratio:1/1;
    height:auto;
    flex:0 0 auto;
    border-radius:0;
    display:block;
    position:relative;
    overflow:hidden;
  }
  .open-post .image-box .image-track{
    display:flex;
    width:100%;
    height:100%;
    gap:0;
    align-items:stretch;
    transition:transform 0.35s ease;
    will-change:transform;
    touch-action: pan-y;
  }
  .open-post .image-box img{
    width:100%;
    height:100%;
    object-fit:cover;
    aspect-ratio:1/1;
    flex:0 0 100%;
  }
  .second-post-column{
    width:100%;
    max-width:520px;
    min-width:0;
    flex:0 0 100%;
  }
  .open-post .second-post-column{
    height:auto;
    max-height:none;
    overflow:visible;
  }
  .open-post .second-post-column .post-details{
    height:auto;
  }
}

@media (max-width:440px){
  :root{
    --footer-h:0;
  }
  body.mode-map{
    --footer-h:0;
  }
  #filterPanel .panel-content{
    top:calc(var(--header-h) + var(--safe-top));
    left:0;
    right:0;
    transform:none;
  }
  .open-post .post-header{
    padding:10px;
  }
  .open-post .post-body{
    padding:0;
  }
}

</style>
  <style id="cursor-fixes">
    html, body { cursor: auto !important; }
    a, button, [role="button"], .clickable { cursor: pointer !important; }
    .mapboxgl-canvas { cursor: grab; }
    .mapboxgl-canvas:active { cursor: grabbing; }
    * { -webkit-tap-highlight-color: transparent; }
  </style>
  <script>
  // --- tiny scheduler helpers ---
  function rafThrottle(fn){
    let scheduled = false, lastArgs, lastThis;
    return function throttled(...args){
      lastArgs = args; lastThis = this;
      if (scheduled) return;
      scheduled = true;
      requestAnimationFrame(() => { scheduled = false; fn.apply(lastThis, lastArgs); });
    };
  }

  // Prefer idle time, but don't stall forever.
  function scheduleIdle(fn, timeout=200){
    if ('requestIdleCallback' in window) {
      requestIdleCallback(fn, { timeout });
    } else {
      setTimeout(fn, Math.min(timeout, 50));
    }
  }

  // Make common high-frequency listeners passive by default (no visual change).
  (function enablePassiveListeners(){
    const PASSIVE = new Set(['wheel','mousewheel','touchstart','touchmove','touchend','touchcancel','scroll']);
    const orig = EventTarget.prototype.addEventListener;
    EventTarget.prototype.addEventListener = function(type, listener, options){
      // Respect explicit options from your code.
      if (options === undefined && PASSIVE.has(type)) {
        options = { passive: true };
      } else if (options && typeof options === 'object' && PASSIVE.has(type) && options.passive === undefined) {
        options = Object.assign({}, options);
      }
      return orig.call(this, type, listener, options);
    };
  })();
  </script>
</head>
<body class="mode-map" style="padding-bottom:var(--footer-h);">
  <header class="header" role="banner">
    <div class="logo" aria-label="Site logo">
      <img src="assets/funmap-logo-small.png" alt="FunMap.com logo" />
    </div>
    <nav class="view-toggle" aria-label="Primary" role="tablist">
      <!-- <button id="quickBtn" aria-pressed="false" aria-label="Toggle results list">Quick List</button> -->
      <button id="filterBtn" aria-pressed="false" aria-label="Open filters panel">
        <svg class="icon-search" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <span id="resultCount" aria-live="polite" style="display:none"></span>
      </button>
      <div class="mode-toggle">
        <button id="recents-button" aria-pressed="false" aria-label="Recents">
          <span class="mode-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
          </span>
          <span class="mode-label">Recents</span>
        </button>
        <button id="posts-button" aria-pressed="false" aria-label="Posts">
          <span class="mode-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="6" x2="19" y2="6"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <line x1="5" y1="18" x2="13" y2="18"></line>
            </svg>
          </span>
          <span class="mode-label">Posts</span>
        </button>
        <button id="map-button" aria-pressed="true" aria-label="Map">
          <span class="mode-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 21s-6-4.5-6-10a6 6 0 1112 0c0 5.5-6 10-6 10z"></path>
              <circle cx="12" cy="11" r="2.5"></circle>
            </svg>
          </span>
          <span class="mode-label">Map</span>
        </button>
      </div>
    </nav>
    <div class="header-buttons">
      <button id="memberBtn" type="button" aria-pressed="false" aria-label="Open members area">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 18.75a6 6 0 00-7.5 0"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 15a3 3 0 100-6 3 3 0 000 6z"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3.75a8.25 8.25 0 100 16.5 8.25 8.25 0 000-16.5z"/>
        </svg>
      </button>
      <button id="adminBtn" type="button" aria-pressed="false" aria-label="Open admin area">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82 2 2 0 1 1-2.83 2.83 1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51 2 2 0 1 1-4 0 1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33 2 2 0 1 1-2.83-2.83 1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1A2 2 0 1 1 4 9a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82A2 2 0 1 1 8.01 3.35a1.65 1.65 0 0 0 1.82-.33 1.65 1.65 0 0 0 1-1.51A2 2 0 1 1 14 3a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33A2 2 0 1 1 19.65 8a1.65 1.65 0 0 0-.33 1.82 1.65 1.65 0 0 0 1.51 1A2 2 0 1 1 21 15a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
      <button id="fullscreenBtn" type="button" class="fullscreen-btn" aria-label="Toggle fullscreen">⛶</button>
    </div>
  </header>
  

  <section class="map-area" aria-label="Map">
    <div class="map-control-row map-controls-map">
      <div id="geocoder-map" class="geocoder"></div>
      <div id="geolocate-map" class="geolocate-btn"></div>
      <div id="compass-map" class="compass-btn"></div>
    </div>
    <div id="map"></div>
  </section>

  <div class="post-mode-background"></div>
  <div class="post-mode-boards">
    <!-- <section class="quick-list-board" id="results" aria-label="Quick List Board"></section> -->
    <section class="recents-board quick-list-board" id="recentsBoard" aria-label="Recents Board">
    </section>
    <section class="post-board" aria-label="Post Board">
    </section>
    <section class="ad-board" aria-label="Ad Board">
      <div class="ad-panel">
      </div>
    </section>
  </div>

  <div id="filterPanel" class="panel" role="dialog" aria-panel="true" aria-hidden="true">
    <div class="panel-content" style="top:calc(var(--header-h) + var(--safe-top));left:0;transform:none;">
      <div class="panel-header">
        <div id="filterSummary" class="filter-summary"></div>
      </div>
      <div class="panel-body">
        <div class="map-control-row map-controls-filter">
          <div id="geocoder-filter" class="geocoder"></div>
          <div id="geolocate-filter" class="geolocate-btn"></div>
          <div id="compass-filter" class="compass-btn"></div>
        </div>
        <div class="reset-box">
          <div id="resetBtn" class="btn" role="button" aria-label="Reset all filters">
            Reset All Filters
          </div>
        </div>
        <div class="reset-box">
          <div id="resetCategoriesBtn" class="btn" role="button" aria-label="Reset all categories">
            Reset All Categories
          </div>
        </div>
        <div class="field sort-field">
          <div class="options-dropdown">
            <button id="optionsBtn" aria-haspopup="true" aria-expanded="false">Sort by Title A-Z</button>
            <div id="optionsMenu" class="options-menu" hidden>
              <button id="favToggle" aria-pressed="false">Favourites on top<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 17.3 6.2 21l1.6-6.7L2 9.3l6.9-.6L12 2l3.1 6.7 6.9.6-5.8 4.9L17.8 21 12 17.3z"/></svg></button>
              <div class="sort-options" role="group" aria-label="Sort order" style="display:flex; flex-direction:column; gap:6px;">
                <button class="sort-option" data-sort="az" aria-pressed="true">Sort by Title A-Z</button>
                <button class="sort-option" data-sort="nearest" aria-pressed="false">Sort by Closest</button>
                <button class="sort-option" data-sort="soon" aria-pressed="false">Sort by Soonest</button>
              </div>
            </div>
          </div>
        </div>
        <section aria-label="Filters">
          <div class="filter-basics-container">
            <div class="field keyword-row">
              <div class="input"><input id="keyword-textbox" type="text" placeholder="Keywords" aria-label="Keywords" />
                <div class="keyword-clear-button" role="button" aria-label="Clear keywords">X</div>
              </div>
            </div>
            <div class="field daterange-row">
              <div class="input"><input id="daterange-textbox" type="text" aria-label="Date range" placeholder="Date Range" readonly />
                <div class="daterange-clear-button" role="button" aria-label="Clear date">X</div>
              </div>
            </div>
            <div class="field expired-row">
              <span class="expired-text">Show Expired Events</span>
              <label class="switch">
                <input id="expiredToggle" type="checkbox" />
                <span class="slider"></span>
              </label>
            </div>
            <div id="datePickerContainer" class="calendar-container">
              <div id="datePicker"></div>
            </div>
          </div>
          <div class="filter-category-container">
            <div class="cats" id="cats" aria-label="Categories"></div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <div id="memberPanel" class="panel" role="dialog" aria-panel="true" aria-hidden="true">
    <div class="panel-content" style="right:0;transform:none;">
      <div class="panel-header">
        <div class="header-top">
          <h2>Create Post</h2>
          <div class="panel-actions">
            <button type="button" class="move-left" aria-label="Move panel left">&lt;</button>
            <button type="button" class="move-right" aria-label="Move panel right">&gt;</button>
            <button type="button" class="close-panel">Close</button>
          </div>
        </div>
      </div>
      <form id="memberForm" class="panel-body">
        <div class="map-control-row map-controls-member">
          <div id="geocoder-member" class="geocoder"></div>
          <div id="geolocate-member" class="geolocate-btn"></div>
          <div id="compass-member" class="compass-btn"></div>
        </div>
        <div class="panel-field">
          <label for="mTitle">Title</label>
          <input type="text" id="mTitle" required />
        </div>
        <div class="panel-field">
          <label for="mImage">Image</label>
          <input type="file" id="mImage" accept="image/*" />
        </div>
        <div class="panel-field">
          <label for="mDate">Date</label>
          <input type="date" id="mDate" />
        </div>
        <div class="panel-field">
          <label for="mColor">Color</label>
          <input type="color" id="mColor" data-mode="hex" value="#000000" />
        </div>
      </form>
    </div>
  </div>

  <div id="adminPanel" class="panel" role="dialog" aria-panel="true" aria-hidden="true">
    <div class="panel-content" style="top:calc(var(--header-h) + var(--safe-top));right:0;transform:none;">
      <div class="panel-header">
        <div class="header-top">
          <h2 class="title">Admin</h2>
          <div class="panel-actions">
            <button type="button" class="move-left" aria-label="Move panel left">&lt;</button>
            <button type="button" class="move-right" aria-label="Move panel right">&gt;</button>
            <button type="button" class="close-panel">Close</button>
          </div>
        </div>
        <div class="tab-bar">
          <button type="button" class="tab-btn" data-tab="map" aria-selected="true">Map</button>
          <button type="button" class="tab-btn" data-tab="settings">Settings</button>
          <button type="button" class="tab-btn" data-tab="forms">Forms</button>
        </div>
      </div>
      <form id="adminForm" class="panel-body">
        <div id="tab-map" class="tab-panel active">
          <div class="map-spin-container">
            <div class="panel-field">
              <label for="spinSpeed">Spin speed</label>
              <div class="range-wrap">
                <input type="range" id="spinSpeed" min="0" max="1" step="0.01" />
                <span id="spinSpeedVal"></span>
              </div>
            </div>
            <div class="panel-field">
              <label for="mapPitch">Pitch</label>
              <div class="range-wrap">
                <input type="range" id="mapPitch" min="0" max="85" step="1" />
                <span id="pitchVal"></span>
              </div>
            </div>
            <div class="panel-field">
              <label for="mapBearing">Bearing</label>
              <div class="range-wrap">
                <input type="range" id="mapBearing" min="-180" max="180" step="1" />
                <span id="bearingVal"></span>
              </div>
            </div>
            <div class="panel-field">
              <div class="option-label">
                <span>Spin on Load</span>
                <label class="switch">
                  <input type="checkbox" id="spinLoadStart" />
                  <span class="slider"></span>
                </label>
              </div>
              <div id="spinType" class="option-group">
                <label class="option-label"><span>Everyone</span><input type="radio" name="spinType" value="all" /></label>
                <label class="option-label"><span>New Users</span><input type="radio" name="spinType" value="new" /></label>
              </div>
            </div>
            <div class="panel-field">
              <div class="option-label">
                <span>Spin on Logo</span>
                <label class="switch">
                  <input type="checkbox" id="spinLogoClick" checked />
                  <span class="slider"></span>
                </label>
              </div>
          </div>
        </div>
        <div id="map-balloon-container" class="map-balloon-container">
          <style>
              #map-balloon-container .t{font-size:16px;font-weight:bold;}
              #map-balloon-container .shape-dropdown{position:relative;width:100%;max-width:100%;height:35px;margin-bottom:8px;}
              #map-balloon-container .shape-dropdown > button{width:100%;height:35px;background:var(--btn);border:1px solid var(--btn);border-radius:var(--dropdown-radius);text-align:left;padding:0;}
              #map-balloon-container .shape-menu{position:absolute;top:calc(100% + 4px);left:0;width:100%;max-height:400px;overflow-y:auto;overflow-y:overlay;background:var(--dropdown-bg);border:1px solid var(--border);border-radius:var(--dropdown-radius);padding:10px;display:flex;flex-direction:column;gap:6px;z-index:30;}
              #map-balloon-container .shape-menu[hidden]{display:none;}
              #map-balloon-container .shape-button{width:100%;height:35px;background:var(--btn);border:1px solid var(--btn);border-radius:var(--dropdown-radius);text-align:left;display:flex;align-items:center;gap:4px;padding:4px;cursor:pointer;}
              #map-balloon-container .shape-button svg{width:24px;height:24px;vertical-align:middle;}
              #map-balloon-container .shape-button.active{outline:2px solid var(--border);}
              #map-balloon-container .panel-field{width:100%;max-width:100%;}
              #map-balloon-container #copySvgCode{width:100%;height:35px;padding:0;margin-bottom:8px;}
              #map-balloon-container #shapeMenuBtn{padding:0;}
              #map-balloon-container #balloonGrid{display:grid;grid-template-columns: repeat(auto-fill, minmax(32px, 1fr)); gap:4px;overflow-x:auto;margin-bottom:8px;}
              #map-balloon-container #balloonGrid svg{cursor:pointer;}
              #map-balloon-container #balloonSvgCode{width:100%;max-width:100%;min-height:200px;}
            </style>
            <div class="t">Balloon Icon Generator</div>
            <div class="shape-dropdown">
              <button type="button" id="shapeMenuBtn" aria-expanded="false">Select Shape</button>
              <div class="shape-menu" id="balloonShapeButtons" hidden></div>
            </div>
            <div class="panel-field size-control">
              <label for="balloonSize">Balloon size</label>
              <div class="range-wrap">
                <input type="range" id="balloonSize" min="40" max="120" value="40" />
                <span id="balloonSizeValue">40</span>px
              </div>
            </div>
            <button type="button" id="copySvgCode">Copy SVG</button>
            <div id="balloonGrid"></div>
            <textarea id="balloonSvgCode"></textarea>
          </div>
        </div>
        <div id="tab-settings" class="tab-panel">
        <div id="post-mode-background-field" class="panel-field">
          <label for="postModeBgColor">Post Mode Background</label>
          <div class="settings-style-container">
            <div id="post-mode-background-row">
              <input type="color" id="postModeBgColor">
              <input type="range" id="postModeBgOpacity" min="0" max="1" step="0.01">
              <span id="postModeBgOpacityVal">0.00</span>
            </div>
          </div>
        </div>
        <div class="settings-welcome-container">
          <div id="welcome-message-panel" class="panel-field">
            <label for="welcomeMessageEditor">Welcome Message</label>
            <div class="wysiwyg-toolbar">
              <button type="button" data-command="bold"><b>B</b></button>
              <button type="button" data-command="italic"><i>I</i></button>
              <button type="button" data-command="underline"><u>U</u></button>
            </div>
            <div id="welcomeMessageEditor" class="wysiwyg" contenteditable="true" data-placeholder="<p>Welcome to Funmap! Choose an area on the map to search for events and listings. Click the Filters button to refine your search.</p>"></div>
            <textarea id="welcomeMessage" hidden></textarea>
          </div>
        </div>
        </div>
        <div id="tab-forms" class="tab-panel">
          <div class="formbuilder-container">
            <div class="cats" id="formbuilderCats" aria-label="Categories"></div>
          </div>
          <style>
            #tab-forms .form-category{margin:10px 0;border:1px solid #ccc;padding:0;}
            #tab-forms .category-header{display:flex;gap:6px;align-items:center;margin-bottom:8px;}
            #tab-forms .subcategory-table{border-collapse:collapse;}
            #tab-forms .subcategory-table td,#tab-forms .subcategory-table th{border:1px solid #999;padding:4px;}
          </style>
          <div id="formsControls">
            <div class="settings-style-container">
              <button type="button" id="addCategory">Add Category</button>
            </div>
            <div id="formsCategories"></div>
          </div>
        </div>
      </form>
  </div>
  </div>

  <script>
    // Remember where the user actually clicked/tapped
    document.addEventListener('pointerdown', (e) => {
      window.__lastPointerDown = e;
    }, { capture: true });

    // Place the opened post right after the clicked .post-card
    function placeOpenPost(el) {
      const anchor = window.__lastPointerDown &&
                     window.__lastPointerDown.target &&
                     window.__lastPointerDown.target.closest('.post-card');
      if (anchor && anchor.parentElement) {
        anchor.after(el);
      } else {
        const board = document.querySelector('.post-board');
        if (board) board.prepend(el);
      }
    }
  </script>

  <div id="welcome-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <!-- Welcome modal content (not a panel) -->
    <div class="modal-content">
      <div class="panel-body" id="welcomeBody">
        <img class="welcome-logo" src="https://raw.githubusercontent.com/Zxen1/Events-Platform/refs/heads/main/assets/funmap-logo-big.png" alt="FunMap logo" />
        <div class="map-control-row map-controls-welcome">
          <div id="geocoder-welcome" class="geocoder"></div>
          <div id="geolocate-welcome" class="geolocate-btn"></div>
          <div id="compass-welcome" class="compass-btn"></div>
        </div>
        <div id="welcomeMessageBox"></div>
        <img class="welcome-illustration" src="assets/monkeys/Firefly_cute-little-monkey-in-red-cape-with-arms-outstretched-in-welcome-609041-600.png" alt="Friendly monkey mascot welcoming visitors" />
      </div>
    </div>
  </div>

  <script>
  async function ensureMapboxCssFor(container) {
    const ver = (window.MAPBOX_VERSION || "v3.15.0").replace(/^v/,'v');
    const cssHref = `https://api.mapbox.com/mapbox-gl-js/${ver}/mapbox-gl.css`;

    const doc = (container && container.ownerDocument) || document;
    const root = container && container.getRootNode && container.getRootNode();

    // For Shadow DOM maps, inject right into the shadow root
    if (root && root.host && typeof ShadowRoot !== "undefined" && root instanceof ShadowRoot) {
      if (!root.querySelector('style[data-mapbox-gl]')) {
        const s = document.createElement('style');
        s.setAttribute('data-mapbox-gl','');
        s.textContent = `@import url('${cssHref}');`;
        root.prepend(s);
      }
      return;
    }

    // Normal document (or iframe document)
    let link = doc.getElementById('mapbox-gl-css');
    if (!link) {
      link = doc.createElement('link');
      link.id = 'mapbox-gl-css';
      link.rel = 'stylesheet';
      link.href = cssHref;
      doc.head.appendChild(link);
    }
    if (link.sheet) return;
    await new Promise(res => link.addEventListener('load', res, { once: true }));
  }

  (async () => {
    try {
      await ensureMapboxCssFor(document.body);
    } catch(e){}
  })();

  (function(){
    const q = [];
    let scheduled = false;
    function flush(){
      scheduled = false;
      const budget = 6;
      let start = performance.now();
      while(q.length){
        const fn = q.shift();
        try{ fn && fn(); }catch(err){ console.error(err); }
        if(performance.now() - start > budget){
          if(typeof requestAnimationFrame === 'function'){
            requestAnimationFrame(flush);
          } else {
            setTimeout(flush, 16);
          }
          return;
        }
      }
    }
    window.deferToAnimationFrame = function(cb){
      q.push(cb);
      if(!scheduled){
        scheduled = true;
        if(typeof requestAnimationFrame === 'function'){
          requestAnimationFrame(flush);
        } else {
          setTimeout(flush, 16);
        }
      }
    };
  })();

  // Helper: do nothing until style is truly loaded
  function whenStyleReady(map, fn){
    if (map.isStyleLoaded && map.isStyleLoaded()) { fn(); return; }
    const onLoad = () => { map.off('load', onLoad); fn(); };
    map.on('load', onLoad);
  }

  function applyNightSky(mapInstance){
    if(!mapInstance) return;
    if(typeof mapInstance.setFog === 'function'){
      try {
        mapInstance.setFog({
          color: 'rgba(11,13,23,0.6)',
          'high-color': 'rgba(27,32,53,0.7)',
          'horizon-blend': 0.15,
          'space-color': '#010409',
          'star-intensity': 0.6
        });
      } catch(err){}
    }
    if(typeof mapInstance.getLayer !== 'function'){
      return;
    }
    let skyLayerId = null;
    const skyPaint = {
      'sky-type': 'gradient',
      'sky-gradient-center': [0, 0],
      'sky-gradient-radius': 80,
      'sky-gradient': [
        'interpolate',
        ['linear'],
        ['sky-radial-progress'],
        0.0, 'rgba(6,10,20,1)',
        0.6, '#0b1d51',
        1.0, '#1a2a6c'
      ],
      'sky-opacity': 1
    };
    try {
      if(mapInstance.getLayer('sky')){
        skyLayerId = 'sky';
      } else if(mapInstance.getLayer('night-sky')){
        skyLayerId = 'night-sky';
      } else if(typeof mapInstance.addLayer === 'function'){
        mapInstance.addLayer({
          id:'night-sky',
          type:'sky',
          paint: skyPaint
        });
        skyLayerId = 'night-sky';
      }
    } catch(err){
      if(!skyLayerId && typeof mapInstance.getLayer === 'function' && mapInstance.getLayer('sky')){
        skyLayerId = 'sky';
      }
    }
    if(!skyLayerId || typeof mapInstance.setPaintProperty !== 'function'){
      return;
    }
    Object.entries(skyPaint).forEach(([prop, value]) => {
      try { mapInstance.setPaintProperty(skyLayerId, prop, value); } catch(err){}
    });
  }

  function createTransparentPlaceholder(size){
    const canvas = document.createElement('canvas');
    const s = Math.max(1, size || 2);
    canvas.width = s;
    canvas.height = s;
    const ctx = canvas.getContext('2d');
    if(ctx){
      ctx.clearRect(0, 0, s, s);
    }
    return canvas;
  }

  function ensurePlaceholderSprites(mapInstance){
    if(!mapInstance || typeof mapInstance.addImage !== 'function') return;
    const required = ['mx-federal-5','background','background-stroke','icon','icon-stroke'];
    required.forEach(name => {
      try{
        if(mapInstance.hasImage?.(name)) return;
        mapInstance.addImage(name, createTransparentPlaceholder(4), { pixelRatio: 1 });
      }catch(err){}
    });
  }

  const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (window.matchMedia && window.matchMedia('(pointer: coarse)').matches);
  const markerIconSize = isTouchDevice ? 1.35 : 1;
  const markerIconBaseSizePx = 30;
  const markerLabelBackgroundWidthPx = 150;
  const markerLabelBackgroundHeightPx = 40;
  const markerLabelBorderRadiusPx = 20;
  const markerLabelBgTranslatePx = markerIconBaseSizePx * markerIconSize / 2 - 2;
  const markerLabelTextPaddingPx = 8;
  const markerLabelTextSize = 12;
  const markerLabelTextTranslatePx = markerLabelBgTranslatePx + markerLabelTextPaddingPx;
  const markerLabelTextMaxWidth = Math.max(3, (markerLabelBackgroundWidthPx - markerLabelTextPaddingPx * 2) / markerLabelTextSize);

  const MARKER_LABEL_BG_ID = 'marker-label-bg';

  function scheduleMarkerLabelBackgroundRetry(mapInstance){
    if(!mapInstance || typeof mapInstance === 'undefined') return;
    const mark = '__markerLabelBgRetryScheduled';
    if(mapInstance[mark]) return;
    mapInstance[mark] = true;
    const retry = () => {
      mapInstance[mark] = false;
      try{ </script>

<div class="image-modal-container hidden">
  <div class="image-modal"></div>
</div>

<div id="post-modal-container" class="hidden">
  <div class="post-modal"></div>
</div>

<script>
  (function(){
    const ns = 'http://www.w3.org/2000/svg';
    const SHAPES = {
      circle(){ const c=document.createElementNS(ns,'circle'); c.setAttribute('cx','0'); c.setAttribute('cy','0'); c.setAttribute('r','50'); return c; },
      tallEllipse(){ const e=document.createElementNS(ns,'ellipse'); e.setAttribute('cx','0'); e.setAttribute('cy','0'); e.setAttribute('rx','40'); e.setAttribute('ry','55'); return e; },
      heart(){ const p=document.createElementNS(ns,'path'); p.setAttribute('d','M0,-30 C-30,-70 -70,-20 -35,15 Q0,55 35,15 C70,-20 30,-70 0,-30Z'); return p; },
      star(){ const p=document.createElementNS(ns,'path'); p.setAttribute('d','M0,-55 L14,-17 L47,-17 L23,5 L35,45 L0,25 L-35,45 L-23,5 L-47,-17 L-14,-17 Z'); return p; },
      triangle(){ const p=document.createElementNS(ns,'path'); p.setAttribute('d','M0,55 L50,-45 L-50,-45 Z'); return p; },
      rectangle(){ const r=document.createElementNS(ns,'rect'); r.setAttribute('x','-35'); r.setAttribute('y','-55'); r.setAttribute('width','70'); r.setAttribute('height','110'); r.setAttribute('rx','20'); r.setAttribute('ry','20'); return r; },
      square(){ const r=document.createElementNS(ns,'rect'); r.setAttribute('x','-45'); r.setAttribute('y','-45'); r.setAttribute('width','90'); r.setAttribute('height','90'); r.setAttribute('rx','20'); r.setAttribute('ry','20'); return r; },
      diamond(){ const p=document.createElementNS(ns,'path'); p.setAttribute('d','M0,-55 L45,0 0,55 -45,0 Z'); return p; },
      pentagon(){ const p=document.createElementNS(ns,'path'); p.setAttribute('d','M0,-55 L52,-17 L32,45 -32,45 -52,-17 Z'); return p; },
      hexagon(){ const p=document.createElementNS(ns,'path'); p.setAttribute('d','M0,-55 L47,-27 L47,27 0,55 -47,27 -47,-27 Z'); return p; }
    };

    function hslToHex(h, s, l){
      s/=100; l/=100;
      const k = n => (n + h/30) % 12;
      const a = s * Math.min(l, 1-l);
      const f = n => l - a * Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
      return '#' + [f(0),f(8),f(4)].map(x=>Math.round(x*255).toString(16).padStart(2,'0')).join('');
    }
    const COLORS = Array.from({length:100}, (_,i)=>hslToHex(i*3.6,100,50));

    function createBalloon(shapeName, color, size){
      const svg = document.createElementNS(ns,'svg');
      svg.setAttribute('viewBox','-60 -80 120 160');
      svg.setAttribute('width', size);
      svg.setAttribute('height', size);
      svg.dataset.color = color;
      svg.setAttribute('title', size + 'px ' + color);
      const body = SHAPES[shapeName]();
      body.setAttribute('fill', color);
      body.setAttribute('stroke', '#000');
      body.setAttribute('stroke-width', '1');
      svg.appendChild(body);
      const tie = document.createElementNS(ns,'path');
      tie.setAttribute('d','M-8,55 L0,60 L8,55 Z');
      tie.setAttribute('fill','#000');
      tie.setAttribute('stroke','#000');
      tie.setAttribute('stroke-width','1');
      svg.appendChild(tie);
      const string = document.createElementNS(ns,'line');
      string.setAttribute('x1','0'); string.setAttribute('y1','60');
      string.setAttribute('x2','0'); string.setAttribute('y2','80');
      string.setAttribute('stroke','#fff');
      string.setAttribute('stroke-width','2');
      svg.appendChild(string);
      const gleam = document.createElementNS(ns,'ellipse');
      gleam.setAttribute('cx','-20'); gleam.setAttribute('cy','-20');
      gleam.setAttribute('rx','10'); gleam.setAttribute('ry','6');
      gleam.setAttribute('fill','#fff');
      svg.appendChild(gleam);
      return svg;
    }

    window.SHAPES = SHAPES;
    window.COLORS = COLORS;
    window.createBalloon = createBalloon;

    const buttons = document.getElementById('balloonShapeButtons');
    const shapeMenuBtn = document.getElementById('shapeMenuBtn');
    const grid = document.getElementById('balloonGrid');
    const sizeSlider = document.getElementById('balloonSize');
    const sizeValue = document.getElementById('balloonSizeValue');
    const svgCode = document.getElementById('balloonSvgCode');
    const copyBtn = document.getElementById('copySvgCode');
    let currentTemplate = '';

    sizeValue.textContent = sizeSlider.value;
    copyBtn.addEventListener('click', ()=>{ navigator.clipboard.writeText(svgCode.value); });

    if(shapeMenuBtn){
      shapeMenuBtn.addEventListener('click', ()=>{
        const expanded = shapeMenuBtn.getAttribute('aria-expanded') === 'true';
        shapeMenuBtn.setAttribute('aria-expanded', String(!expanded));
        buttons.hidden = expanded;
      });
      document.addEventListener('click', e=>{
        if(!shapeMenuBtn.contains(e.target) && !buttons.contains(e.target)){
          buttons.hidden = true;
          shapeMenuBtn.setAttribute('aria-expanded','false');
        }
      });
    }

    sizeSlider.addEventListener('input', ()=>{
      sizeValue.textContent = sizeSlider.value;
      renderFromSvg(currentTemplate);
    });

    function selectSvg(svg){
      grid.querySelectorAll('svg').forEach(s=>s.classList.remove('selected'));
      svg.classList.add('selected');
      svgCode.value = svg.outerHTML;
      currentTemplate = svg.outerHTML;
      if(document.hasFocus()){
        try{
          navigator.clipboard.writeText(svg.outerHTML);
        }catch(e){
          console.error('clipboard write failed', e);
        }
      }
    }

    function renderFromSvg(template){
      if(!template){ return; }
      grid.innerHTML='';
      COLORS.forEach(color=>{
        const colored = template.replace(/fill="(?!#fff)[^"]*"/g, `fill="${color}"`);
        const doc = new DOMParser().parseFromString(colored,'image/svg+xml');
        const svg = doc.documentElement;
        svg.setAttribute('width', sizeSlider.value);
        svg.setAttribute('height', sizeSlider.value);
        svg.dataset.color = color;
        svg.setAttribute('title', sizeSlider.value + 'px ' + color);
        svg.addEventListener('click', ()=> selectSvg(svg));
        grid.appendChild(svg);
      });
      const first = grid.querySelector('svg');
      if(first){
        first.classList.add('selected');
        svgCode.value = first.outerHTML;
        currentTemplate = first.outerHTML;
      }
    }

    function render(name){
      grid.innerHTML='';
      COLORS.forEach(color=>{
        const svg = createBalloon(name, color, sizeSlider.value);
        svg.addEventListener('click', ()=> selectSvg(svg));
        grid.appendChild(svg);
      });
      const first = grid.querySelector('svg');
      if(first){
        first.classList.add('selected');
        svgCode.value = first.outerHTML;
        currentTemplate = first.outerHTML;
      }
    }

    svgCode.addEventListener('input', ()=>{
      currentTemplate = svgCode.value;
      renderFromSvg(currentTemplate);
    });

    const LABELS = {
      circle:'circle',
      tallEllipse:'tall ellipse',
      heart:'heart',
      star:'soft star',
      triangle:'soft triangle',
      rectangle:'tall rectangle',
      square:'square',
      diamond:'diamond',
      pentagon:'pentagon',
      hexagon:'hexagon'
    };

    Object.keys(SHAPES).forEach((name,idx)=>{
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'shape-button';
      btn.appendChild(createBalloon(name, '#000', 24));
      btn.appendChild(document.createTextNode(LABELS[name] || name));
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('#map-balloon-container .shape-button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        render(name);
        if(shapeMenuBtn){
          shapeMenuBtn.textContent = LABELS[name] || name;
          shapeMenuBtn.setAttribute('aria-expanded','false');
          buttons.hidden = true;
        }
      });
      if(idx===0) btn.classList.add('active');
      buttons.appendChild(btn);
    });

    const firstShape = Object.keys(SHAPES)[0];
    render(firstShape);
    if(shapeMenuBtn){ shapeMenuBtn.textContent = LABELS[firstShape] || firstShape; }
  })();
</script>
<script>
(function(){
  const ICON_BASE = window.ICON_BASE || {};
  const subcategoryIcons = window.subcategoryIcons || (window.subcategoryIcons = {});
  const subcategoryMarkers = window.subcategoryMarkers || (window.subcategoryMarkers = {});
  const subcategoryMarkerIds = window.subcategoryMarkerIds || (window.subcategoryMarkerIds = {});
  const categoryShapes = window.categoryShapes || (window.categoryShapes = {});
  const shapeList = Object.keys(window.SHAPES || {});
  let colorIdx = 0;
  const cats = window.categories || [];
  cats.forEach((cat, idx) => {
    const shape = shapeList[idx % shapeList.length];
    categoryShapes[cat.name] = shape;
    cat.subs.forEach(sub => {
      const color = window.COLOR_NAMES[colorIdx % window.COLOR_NAMES.length];
      colorIdx++;
      const slug = slugify(sub);
      const iconPrefix = ICON_BASE[cat.name];
      const icon20 = `assets/icons-20/${iconPrefix}-${color}-20.webp`;
      const icon30 = `assets/icons-30/${iconPrefix}-${color}-30.webp`;
      subcategoryIcons[sub] = `<img src="${icon20}" width="20" height="20" alt="">`;
      subcategoryMarkerIds[sub] = slug;
      subcategoryMarkers[slug] = icon30;
    });
  });
  const specialSubIconPaths = {
    'Other Events': 'assets/icons-20/whats-on-category-icon-red-20.webp',
    'Other Opportunities': 'assets/icons-20/opportunities-category-icon-red-20.webp',
    'Other Learning': 'assets/icons-20/learning-category-icon-red-20.webp'
  };
  Object.entries(specialSubIconPaths).forEach(([name, path20]) => {
    const markerPath = path20
      .replace('icons-20', 'icons-30')
      .replace('-20.webp', '-30.webp');
    subcategoryIcons[name] = `<img src="${path20}" width="20" height="20" alt="">`;
    const slug = subcategoryMarkerIds[name] || slugify(name);
    subcategoryMarkers[slug] = markerPath;
    subcategoryMarkers[name] = markerPath;
  });
  document.dispatchEvent(new CustomEvent('subcategory-icons-ready'));
  if(window.postsLoaded) addPostSource();
})();
</script>
<script>
(function(){
  const ICONS = {
    circle:'<svg viewBox="0 0 20 20"><circle cx="10" cy="10" r="8" fill="#000"/></svg>',
    square:'<svg viewBox="0 0 20 20"><rect x="2" y="2" width="16" height="16" fill="#000"/></svg>',
    triangle:'<svg viewBox="0 0 20 20"><polygon points="10,2 18,18 2,18" fill="#000"/></svg>'
  };
  const FIELD_TYPES = ['Text','Number','Date','Color'];
  function createIconSelect(){
    const s=document.createElement('select');
    Object.keys(ICONS).forEach(k=>{
      const o=document.createElement('option');
      o.value=k;
      o.innerHTML=ICONS[k];
      s.appendChild(o);
    });
    return s;
  }
  function createFieldSelect(){
    const s=document.createElement('select');
    FIELD_TYPES.forEach(t=>{
      const o=document.createElement('option');
      o.value=t.toLowerCase();
      o.textContent=t;
      s.appendChild(o);
    });
    return s;
  }
  function addSubcategory(table){
    const iconRow=table.querySelector('.icon-row');
    const nameRow=table.querySelector('.name-row');
    const iconCell=document.createElement('td'); iconCell.appendChild(createIconSelect()); iconRow.appendChild(iconCell);
    const nameCell=document.createElement('td'); const inp=document.createElement('input'); nameCell.appendChild(inp); nameRow.appendChild(nameCell);
    table.querySelectorAll('.field-row').forEach(row=>{
      const cell=document.createElement('td'); cell.appendChild(createFieldSelect()); row.appendChild(cell);
    });
  }
  function addFieldRow(table){
    const cols=table.querySelector('.icon-row').children.length;
    const row=document.createElement('tr'); row.className='field-row';
    for(let i=0;i<cols;i++){ const cell=document.createElement('td'); cell.appendChild(createFieldSelect()); row.appendChild(cell); }
    table.appendChild(row);
  }
  function wireCategory(cat){
    const table=cat.querySelector('table');
    cat.querySelector('.delete-category').addEventListener('click',()=>cat.remove());
    cat.querySelector('.copy-category').addEventListener('click',()=>{const clone=cat.cloneNode(true); wireCategory(clone); cat.after(clone);});
    cat.querySelector('.add-subcategory').addEventListener('click',()=>addSubcategory(table));
    cat.querySelector('.add-field').addEventListener('click',()=>addFieldRow(table));
  }
  function createCategory(){
    const cat=document.createElement('div'); cat.className='form-category';
    const header=document.createElement('div'); header.className='category-header';
    const name=document.createElement('input'); name.type='text'; name.placeholder='Category name';
    const icon=createIconSelect();
    const color=document.createElement('input'); color.type='color'; color.value='#000000';
    const copy=document.createElement('button'); copy.type='button'; copy.className='copy-category'; copy.textContent='Copy';
    const del=document.createElement('button'); del.type='button'; del.className='delete-category'; del.textContent='Delete';
    header.append(name,icon,color,copy,del);
    cat.appendChild(header);
    const table=document.createElement('table'); table.className='subcategory-table';
    const iconRow=document.createElement('tr'); iconRow.className='icon-row';
    const nameRow=document.createElement('tr'); nameRow.className='name-row';
    table.append(iconRow,nameRow);
    cat.appendChild(table);
    const addSub=document.createElement('button'); addSub.type='button'; addSub.className='add-subcategory'; addSub.textContent='Add Subcategory';
    const addField=document.createElement('button'); addField.type='button'; addField.className='add-field'; addField.textContent='Add Field';
    cat.append(addSub,addField);
    addSubcategory(table);
    addFieldRow(table);
    wireCategory(cat);
    return cat;
  }
  document.getElementById('addCategory').addEventListener('click',()=>{
    const cat=createCategory();
    document.getElementById('formsCategories').appendChild(cat);
  });
})();
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const editor = document.getElementById('welcomeMessageEditor');
  const hidden = document.getElementById('welcomeMessage');
  if(editor && hidden){
    const placeholder = editor.getAttribute('data-placeholder') || '';
    hidden.value = hidden.value || placeholder;
    editor.innerHTML = hidden.value;
    editor.addEventListener('input', () => hidden.value = editor.innerHTML);
document.querySelectorAll('.wysiwyg-toolbar button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.execCommand(btn.dataset.command, false, null);
        editor.focus();
      });
    });
  }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('#adminPanel input[type="checkbox"]').forEach(cb => {
    if (cb.closest('.switch')) return;
    const wrapper = document.createElement('label');
    wrapper.className = 'switch';
    cb.parentNode.insertBefore(wrapper, cb);
    wrapper.appendChild(cb);
    const slider = document.createElement('span');
    slider.className = 'slider';
    cb.after(slider);
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const colorInput = document.getElementById('postModeBgColor');
  const opacityInput = document.getElementById('postModeBgOpacity');
  const opacityVal = document.getElementById('postModeBgOpacityVal');
  const root = document.documentElement;
  const settings = JSON.parse(localStorage.getItem('admin-settings-current') || '{}');
  function hexToRgb(hex){
    const r = parseInt(hex.slice(1,3),16);
    const g = parseInt(hex.slice(3,5),16);
    const b = parseInt(hex.slice(5,7),16);
    return `${r},${g},${b}`;
  }

  function apply(){
    const color = colorInput.value || '#000000';
    const opacity = opacityInput.value;
    root.style.setProperty('--post-mode-bg-color', hexToRgb(color));
    root.style.setProperty('--post-mode-bg-opacity', opacity);
    opacityVal.textContent = Number(opacity).toFixed(2);
  }

  if(colorInput && opacityInput && opacityVal){
    colorInput.value = settings.postModeBgColor || '#000000';
    opacityInput.value = settings.postModeBgOpacity ?? 0;
    apply();
    const save = () => {
      settings.postModeBgColor = colorInput.value;
      settings.postModeBgOpacity = opacityInput.value;
      localStorage.setItem('admin-settings-current', JSON.stringify(settings));
    };
    colorInput.addEventListener('input', () => { apply(); save(); });
    opacityInput.addEventListener('input', () => { apply(); save(); });
    const prev = window.saveAdminChanges;
    window.saveAdminChanges = () => { save(); if(typeof prev === 'function') prev(); };
  }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const vp = document.getElementById('viewport');
  const updateViewport = () => {
    if (!vp) return;
    if (window.innerWidth < 650) {
      vp.setAttribute('content','width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no');
    } else {
      vp.setAttribute('content','width=device-width, initial-scale=1');
    }
  };
  updateViewport();
  window.addEventListener('resize', updateViewport);
  window.addEventListener('orientationchange', updateViewport);

  const fsBtn = document.getElementById('fullscreenBtn');
  if (fsBtn) {
    const docEl = document.documentElement;
    const canFS = docEl.requestFullscreen || docEl.webkitRequestFullscreen || docEl.mozRequestFullScreen || docEl.msRequestFullscreen;
    const enabled = document.fullscreenEnabled || document.webkitFullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled;
    if (!canFS || enabled === false) {
      fsBtn.style.display = 'none';
    } else {
      const getFull = () => document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
      const updateFsState = () => {
        fsBtn.setAttribute('aria-pressed', getFull() ? 'true' : 'false');
      };
      updateFsState();
      ['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange'].forEach(evt => {
        document.addEventListener(evt, updateFsState);
      });
      fsBtn.addEventListener('click', () => {
        const isFull = getFull();
        if (!isFull) {
          const req = docEl.requestFullscreen || docEl.webkitRequestFullscreen || docEl.mozRequestFullScreen || docEl.msRequestFullscreen;
          if (req) {
            try {
              const result = req.call(docEl);
              if (result && typeof result.catch === 'function') result.catch(() => {});
            } catch (err) {
              updateFsState();
            }
          }
        } else {
          const exit = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;
          if (exit) {
            try {
              const result = exit.call(document);
              if (result && typeof result.catch === 'function') result.catch(() => {});
            } catch (err) {
              updateFsState();
            }
          }
        }
      });
    }
  }

  if (window.innerWidth >= 650) return;

  const posts = document.querySelector('.post-board');
  if (!posts) return;

  let defaultSize = parseFloat(getComputedStyle(posts).fontSize);
  let startDist = null;
  let enlarged = false;

  function distance(t1, t2){
    return Math.hypot(t1.clientX - t2.clientX, t1.clientY - t2.clientY);
  }

  posts.addEventListener('touchstart', e => {
    if (e.target.tagName === 'IMG') return;
    if (e.touches.length === 2) {
      startDist = distance(e.touches[0], e.touches[1]);
    }
  });

  posts.addEventListener('touchmove', e => {
    if (e.target.tagName === 'IMG') return;
    if (e.touches.length === 2 && startDist) {
      const scale = distance(e.touches[0], e.touches[1]) / startDist;
      if (!enlarged && scale > 1.2) {
        posts.style.fontSize = (defaultSize * 1.2) + 'px';
        enlarged = true;
      } else if (enlarged && scale < 0.8) {
        posts.style.fontSize = defaultSize + 'px';
        enlarged = false;
      }
      e.preventDefault();
    }
  }, { passive: false });

  posts.addEventListener('touchend', e => {
    if (e.touches.length < 2) startDist = null;
  });

  function openImagePopup(src){
    const overlay = document.createElement('div');
    overlay.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:9999;';
    const big = document.createElement('img');
    big.src = src;
    big.style.cssText = 'max-width:90%;max-height:90%;touch-action:pinch-zoom;';
    overlay.appendChild(big);
    overlay.addEventListener('click', () => overlay.remove());
    document.body.appendChild(overlay);
  }

posts.querySelectorAll('img').forEach(img => {
    img.addEventListener('click', e => { e.stopPropagation(); openImagePopup(img.src); });
    img.addEventListener('touchstart', e => {
      if (e.touches.length === 2) {
        e.preventDefault();
        e.stopPropagation();
        openImagePopup(img.src);
      }
    }, { passive: false });
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('input[type="color"]').forEach(el => {
    if(!el.value) el.value = '#000000';
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.addEventListener('wheel', e => {
    if(e.target.closest('.post-board, .panel-content, .options-menu, .calendar-scroll')){
      e.stopPropagation();
    }
  });
  const postsPanel = document.querySelector('.post-board');
  const postsBg = document.querySelector('.post-mode-background');
  if(postsPanel){
    postsPanel.addEventListener('click', e => {
      if(e.target === postsPanel || e.target.classList.contains('posts')){
        e.stopPropagation();
      }
    });
  }
  if(postsBg){
    postsBg.addEventListener('click', e => e.stopPropagation());
  }
});
</script>
<script>
let boardAdjustCleanup = null;

function initPostLayout(board){
  if(typeof boardAdjustCleanup === 'function'){
    boardAdjustCleanup();
    boardAdjustCleanup = null;
  }
  const scheduleMapResize = mapInstance => {
    if(!mapInstance) return;
    if(typeof mapInstance.resize === 'function'){
      requestAnimationFrame(()=>{
        try { mapInstance.resize(); } catch(err){}
      });
    }
  };
  if(!(board instanceof Element)){
    document.documentElement.style.removeProperty('--post-header-h');
    if(typeof window.adjustBoards === 'function') window.adjustBoards();
    return;
  }
  const openPost = board.querySelector('.open-post');
  if(!openPost){
    document.body.classList.remove('detail-open');
    document.body.classList.remove('hide-map-calendar');
    document.documentElement.style.removeProperty('--post-header-h');
    if(typeof window.adjustBoards === 'function') window.adjustBoards();
    return;
  }
  document.body.classList.add('detail-open');
  document.body.classList.remove('hide-map-calendar');
  const postBody = openPost.querySelector('.post-body');
  const secondCol = postBody ? postBody.querySelector('.second-post-column') : null;
  if(secondCol){
    secondCol.removeAttribute('hidden');
    secondCol.classList.remove('is-visible');
    if(secondCol.dataset) delete secondCol.dataset.openPostId;
  }
  const triggerDetailMapResize = target => {
    if(!target) return;
    const mapNode = target.querySelector ? target.querySelector('.post-map') : null;
    const ref = target._detailMap || (mapNode && mapNode._detailMap) || null;
    const mapInstance = ref && ref.map;
    if(mapInstance && typeof mapInstance.resize === 'function'){
      scheduleMapResize(mapInstance);
    }
  };
  triggerDetailMapResize(secondCol);
  const thumbRow = postBody ? postBody.querySelector('.thumbnail-row') : null;
  const selectedImageBox = postBody ? postBody.querySelector('.selected-image, .image-box') : null;
  const imageModalContainer = document.querySelector('.image-modal-container');
  const imageModal = imageModalContainer ? imageModalContainer.querySelector('.image-modal') : null;
  if(thumbRow){
    thumbRow.scrollLeft = 0;
  }
  function openImageModal(src){
    if(!imageModalContainer || !imageModal) return;
    imageModal.innerHTML='';
    const img = document.createElement('img');
    img.src = src;
    imageModal.appendChild(img);
    imageModalContainer.classList.remove('hidden');
  }
  if(imageModalContainer && !imageModalContainer._listenerAdded){
    imageModalContainer.addEventListener('click', e => {
      if(e.target === imageModalContainer){
        imageModalContainer.classList.add('hidden');
        if(imageModal) imageModal.innerHTML='';
      }
    });
    imageModalContainer._listenerAdded = true;
  }
  if(thumbRow && !thumbRow._imageModalListener){
    thumbRow.addEventListener('dblclick', e => {
      const img = e.target.closest('img');
      if(img){
        e.preventDefault();
        e.stopPropagation();
        openImageModal(img.src);
      }
    });
    thumbRow._imageModalListener = true;
  }
  if(selectedImageBox && !selectedImageBox._imageModalListener){
    selectedImageBox.addEventListener('click', evt => {
      const img = selectedImageBox.querySelector('img');
      if(img){
        if(evt && typeof evt.preventDefault === 'function') evt.preventDefault();
        if(evt && typeof evt.stopPropagation === 'function') evt.stopPropagation();
        openImageModal(img.src);
      }
    });
    selectedImageBox._imageModalListener = true;
  }
  if(typeof updateStickyImages === 'function'){
    updateStickyImages();
  }
  const updateMetrics = () => {
    if(typeof updateStickyImages === 'function'){
      updateStickyImages();
    }
    if(openPost){
      const header = openPost.querySelector('.post-header');
      if(header){
        document.documentElement.style.setProperty('--post-header-h', header.offsetHeight + 'px');
      } else {
        document.documentElement.style.removeProperty('--post-header-h');
      }
    }
    triggerDetailMapResize(secondCol);
    if(typeof window.adjustBoards === 'function') window.adjustBoards();
  };
  updateMetrics();
  window.addEventListener('resize', updateMetrics);
  window.addEventListener('load', updateMetrics);
  boardAdjustCleanup = () => {
    window.removeEventListener('resize', updateMetrics);
    window.removeEventListener('load', updateMetrics);
  };
}

document.addEventListener('DOMContentLoaded', () => {
  initPostLayout(document.querySelector('.post-board'));
});
</script>

<script>
// Wait helpers if your app exposes callWhenDefined; otherwise poll.
(function(){
  function whenDefined(name, cb){
    if (window.callWhenDefined) return window.callWhenDefined(name, cb);
    const iv = setInterval(() => {
      if (typeof window[name] === 'function') { clearInterval(iv); cb(window[name]); }
    }, 20);
  }

  // Debounce/guard in-flight jobs by name
  const _inflight = new Map();
  function guardOnce(name, fn){
    return async function guarded(...args){
      if (_inflight.get(name)) return; // drop duplicates
      _inflight.set(name, true);
      try { return await fn.apply(this, args); }
      finally { _inflight.delete(name); }
    };
  }

  const factories = new Map([
    ['openPost', (orig) => rafThrottle(function(...args){
      scheduleIdle(() => orig.apply(this, args));
    })],
    ['hookDetailActions', (orig) => {
      const wrapped = rafThrottle(function(...args){
        scheduleIdle(() => orig.apply(this, args));
      });
      return guardOnce('hookDetailActions', wrapped);
    }],
    ['ensureMapForVenue', (orig) => {
      let token = 0;
      return guardOnce('ensureMapForVenue', function(...args){
        const myToken = ++token;
        // Defer heavy create to idle; newest call wins.
        scheduleIdle(async () => {
          if (myToken !== token) return;
          try { await orig.apply(this, args); } catch(e) { /* swallow */ }
        }, 300);
      });
    }]
  ]);

  function applyWrapper(name){
    const factory = factories.get(name);
    if (!factory) return;
    whenDefined(name, (orig) => {
      if (typeof orig !== 'function' || orig.__inputWrapped) return;
      const wrapped = factory(orig);
      if (typeof wrapped === 'function'){
        wrapped.__inputWrapped = true;
        window[name] = wrapped;
      }
    });
  }

  ['openPost','hookDetailActions','ensureMapForVenue'].forEach(applyWrapper);

  window.__wrapForInputYield = function(name){
    applyWrapper(name);
  };
})();
</script>
</body>
</html>